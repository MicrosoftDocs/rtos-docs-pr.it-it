---
title: Capitolo 1-Introduzione ad Azure RTO NetX Duo SNTP
description: Azure RTO NetX Simple Network Time Protocol (SNTP) è un protocollo progettato per sincronizzare gli orologi in Internet.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: b3e1170197c6c4981060459104da80e354fac5db
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/22/2021
ms.locfileid: "104821656"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-sntp"></a><span data-ttu-id="c28b5-103">Capitolo 1-Introduzione ad Azure RTO NetX Duo SNTP</span><span class="sxs-lookup"><span data-stu-id="c28b5-103">Chapter 1 - Introduction to Azure RTOS NetX Duo SNTP</span></span> 

<span data-ttu-id="c28b5-104">Azure RTO NetX Simple Network Time Protocol (SNTP) è un protocollo progettato per sincronizzare gli orologi in Internet.</span><span class="sxs-lookup"><span data-stu-id="c28b5-104">The Azure RTOS NetX Simple Network Time Protocol (SNTP) is a protocol designed for synchronizing clocks over the Internet.</span></span> <span data-ttu-id="c28b5-105">SNTP versione 4 è un protocollo semplificato basato sul protocollo NTP (Network Time Protocol).</span><span class="sxs-lookup"><span data-stu-id="c28b5-105">SNTP Version 4 is a simplified protocol based on the Network Time Protocol (NTP).</span></span> <span data-ttu-id="c28b5-106">USA i servizi UDP (User Datagram Protocol) per eseguire gli aggiornamenti temporali in un protocollo semplice e senza stato.</span><span class="sxs-lookup"><span data-stu-id="c28b5-106">It utilizes User Datagram Protocol (UDP) services to perform time updates in a simple, stateless protocol.</span></span> <span data-ttu-id="c28b5-107">Sebbene non sia complesso come NTP, SNTP è altamente affidabile e accurato.</span><span class="sxs-lookup"><span data-stu-id="c28b5-107">Though not as complex as NTP, SNTP is highly reliable and accurate.</span></span> <span data-ttu-id="c28b5-108">Nella maggior parte dei casi di Internet di oggi, SNTP offre un'accuratezza di 1-50 millisecondi, a seconda delle caratteristiche dei percorsi di origine e di rete della sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="c28b5-108">In most places of the Internet of today, SNTP provides accuracies of 1-50 milliseconds, depending on the characteristics of the synchronization source and network paths.</span></span> <span data-ttu-id="c28b5-109">SNTP offre molte opzioni per garantire l'affidabilità della ricezione degli aggiornamenti temporali.</span><span class="sxs-lookup"><span data-stu-id="c28b5-109">SNTP has many options to provide reliability of receiving time updates.</span></span> <span data-ttu-id="c28b5-110">Possibilità di passare a server alternativi, applicando gli algoritmi di polling e l'individuazione automatica del server ora, solo alcuni dei modi in cui un client SNTP gestisce un ambiente del servizio di tempo Internet variabile.</span><span class="sxs-lookup"><span data-stu-id="c28b5-110">Ability to switch to alternative servers, applying back off polling algorithms and automatic time server discovery are just a few of the means for an SNTP client to handle a variable Internet time service environment.</span></span> <span data-ttu-id="c28b5-111">Ciò che manca in precisione è costituito dalla semplicità e dalla facilità di implementazione.</span><span class="sxs-lookup"><span data-stu-id="c28b5-111">What it lacks in precision it makes up for in simplicity and ease of implementation.</span></span> <span data-ttu-id="c28b5-112">SNTP è concepito principalmente per fornire meccanismi completi per accedere ai servizi di diffusione di ora e frequenza nazionali (ad esempio, server NTP).</span><span class="sxs-lookup"><span data-stu-id="c28b5-112">SNTP is intended primarily for providing comprehensive mechanisms to access national time and frequency dissemination (e.g. NTP server) services.</span></span>

## <a name="netx-duo-sntp-client-requirements"></a><span data-ttu-id="c28b5-113">Requisiti del client NetX Duo SNTP</span><span class="sxs-lookup"><span data-stu-id="c28b5-113">NetX Duo SNTP Client Requirements</span></span>

<span data-ttu-id="c28b5-114">Il client NetX Duo SNTP richiede che sia già stata creata un'istanza IP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-114">The NetX Duo SNTP Client requires that an IP instance has already been created.</span></span> <span data-ttu-id="c28b5-115">Inoltre, è necessario abilitare UDP nella stessa istanza IP e avere accesso alla porta *nota* 123 per inviare i dati temporali a un server SNTP, anche se le porte alternative funzioneranno.</span><span class="sxs-lookup"><span data-stu-id="c28b5-115">In addition, UDP must be enabled on that same IP instance and should have access to the *well-known* port 123 for sending time data to an SNTP Server, although alternative ports will work as well.</span></span> <span data-ttu-id="c28b5-116">I client broadcast devono associare la porta UDP su cui è in corso l'invio del server di trasmissione, in genere 123.</span><span class="sxs-lookup"><span data-stu-id="c28b5-116">Broadcast clients should bind the UDP port their broadcast server is sending on, usually 123.</span></span> <span data-ttu-id="c28b5-117">L'applicazione client NetX Duo SNTP deve avere uno o più indirizzi IP SNTP server.</span><span class="sxs-lookup"><span data-stu-id="c28b5-117">The NetX Duo SNTP Client application must have one or more IP SNTP Server addresses.</span></span>

## <a name="netx-duo-sntp-client-limitations"></a><span data-ttu-id="c28b5-118">Limitazioni di NetX Duo SNTP client</span><span class="sxs-lookup"><span data-stu-id="c28b5-118">NetX Duo SNTP Client Limitations</span></span> 

<span data-ttu-id="c28b5-119">La precisione nella rappresentazione dell'ora locale negli aggiornamenti del tempo NTP gestiti dall'API client SNTP è limitata alla risoluzione dei millisecondi.</span><span class="sxs-lookup"><span data-stu-id="c28b5-119">Precision in local time representation in NTP time updates handled by the SNTP Client API is limited to millisecond resolution.</span></span>

<span data-ttu-id="c28b5-120">Il client SNTP dispone solo di un singolo indirizzo del server di SNTP in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="c28b5-120">The SNTP Client only holds a single SNTP Server address at any time.</span></span> <span data-ttu-id="c28b5-121">Se il server non risulta più valido, l'applicazione deve arrestare l'attività client SNTP e reinizializzarla con un altro indirizzo del server SNTP, usando la comunicazione broadcast o unicast SNTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-121">If that Server appears to be no longer valid, the application must stop the SNTP Client task, and reinitialize it with another SNTP server address, using either broadcast or unicast SNTP communication.</span></span>

<span data-ttu-id="c28b5-122">Il client SNTP non supporta manycast.</span><span class="sxs-lookup"><span data-stu-id="c28b5-122">The SNTP Client does not support manycast.</span></span>

<span data-ttu-id="c28b5-123">NetX Duo SNTP client non supporta i meccanismi di autenticazione per la verifica dei dati di pacchetti ricevuti.</span><span class="sxs-lookup"><span data-stu-id="c28b5-123">NetX Duo SNTP Client does not support authentication mechanisms for verifying received packet data.</span></span>

## <a name="netx-duo-sntp-client-operation"></a><span data-ttu-id="c28b5-124">Operazione client NetX Duo SNTP</span><span class="sxs-lookup"><span data-stu-id="c28b5-124">NetX Duo SNTP Client Operation</span></span>

<span data-ttu-id="c28b5-125">RFC 4330 consiglia di usare i client di SNTP solo nel primo strato della rete locale e preferibilmente nelle configurazioni in cui nessun client NTP o SNTP è dipendente dalla sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="c28b5-125">RFC 4330 recommends that SNTP clients should operate only at the highest stratum of their local network and preferably in configurations where no NTP or SNTP client is dependent them for synchronization.</span></span> <span data-ttu-id="c28b5-126">Il livello di strato riflette la posizione dell'host nella gerarchia del tempo NTP in cui lo strato 1 è il livello più alto (un server radice) e 15 è il livello più basso consentito (ad esempio, client).</span><span class="sxs-lookup"><span data-stu-id="c28b5-126">Stratum level reflects the host position in the NTP time hierarchy where stratum 1 is the highest level (a root time server) and 15 is the lowest allowed level (e.g. Client).</span></span> <span data-ttu-id="c28b5-127">Lo strato minimo predefinito del client SNTP è 2.</span><span class="sxs-lookup"><span data-stu-id="c28b5-127">The SNTP Client default minimum stratum is 2.</span></span>

<span data-ttu-id="c28b5-128">Il client NetX Duo SNTP può funzionare in una delle due modalità di base, unicast o broadcast, per ottenere tempo su Internet.</span><span class="sxs-lookup"><span data-stu-id="c28b5-128">The NetX Duo SNTP Client can operate in one of two basic modes, unicast or broadcast, to obtain time over the Internet.</span></span> <span data-ttu-id="c28b5-129">In modalità unicast, il client esegue il polling del server SNTP a intervalli regolari e attende la ricezione di una risposta da tale server.</span><span class="sxs-lookup"><span data-stu-id="c28b5-129">In unicast mode, the Client polls its SNTP Server on regular intervals and waits to receive a reply from that Server.</span></span> <span data-ttu-id="c28b5-130">Quando ne viene ricevuta una, il client verifica che la risposta contenga un aggiornamento dell'ora valido applicando un set di ' verifiche di integrità' consigliate da RFC 4330.</span><span class="sxs-lookup"><span data-stu-id="c28b5-130">When one is received, the Client verifies that the reply contains a valid time update by applying a set of ‘sanity checks’ recommended by RFC 4330.</span></span> <span data-ttu-id="c28b5-131">Il client applica quindi la differenza di tempo, se presente, con l'orologio del server al proprio orologio locale.</span><span class="sxs-lookup"><span data-stu-id="c28b5-131">The Client then applies the time difference, if any, with the Server clock to its local clock.</span></span> <span data-ttu-id="c28b5-132">In modalità broadcast il client ascolta solo le trasmissioni di aggiornamento del tempo e mantiene il proprio orologio locale dopo aver applicato un set di controlli di integrità per verificare i dati relativi all'ora di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="c28b5-132">In broadcast mode, the Client merely listens for time update broadcasts and maintains its local clock after applying a similar set of sanity checks to verify the update time data.</span></span> <span data-ttu-id="c28b5-133">I controlli di integrità sono descritti in dettaglio nella sezione **controlli di integrità di SNTP** riportata di seguito.</span><span class="sxs-lookup"><span data-stu-id="c28b5-133">Sanity checks are described in detail in the **SNTP Sanity Checks** section below.</span></span>

<span data-ttu-id="c28b5-134">Prima che il client possa essere eseguito in una delle due modalità, deve stabilirne i parametri operativi.</span><span class="sxs-lookup"><span data-stu-id="c28b5-134">Before the Client can run in either mode, it must establish its operating parameters.</span></span> <span data-ttu-id="c28b5-135">Questa operazione viene eseguita chiamando rispettivamente *nx_sntp_client_initialize_unicast* o *nx_sntp_client_initialize_broadcast* per le modalità unicast o broadcast.</span><span class="sxs-lookup"><span data-stu-id="c28b5-135">This is done by calling either *nx_sntp_client_initialize_unicast* or *nx_sntp_client_initialize_broadcast* for unicast or broadcast modes, respectively.</span></span> <span data-ttu-id="c28b5-136">Queste funzioni impostano i timeout per un intervallo di tempo massimo senza un aggiornamento valido, il limite per gli aggiornamenti consecutivi non validi ricevuti, un intervallo di polling per la modalità unicast, la modalità operativa, ad esempio unicast rispetto a broadcast e il server SNTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-136">These serves set the time outs for maximum time lapse without a valid update, the limit on consecutive invalid updates received, a polling interval for unicast mode, operation mode e.g. unicast vs. broadcast, and SNTP Server.</span></span>

<span data-ttu-id="c28b5-137">Se viene superato il limite massimo di tempo o di aggiornamenti non validi ricevuti, il client SNTP continua a essere eseguito, ma imposta lo stato corrente del server SNTP su non valido.</span><span class="sxs-lookup"><span data-stu-id="c28b5-137">If the maximum time lapse or maximum invalid updates received is exceeded, the SNTP Client continues to run but sets the current SNTP Server status to invalid.</span></span> <span data-ttu-id="c28b5-138">L'applicazione può eseguire il polling del client SNTP usando il servizio *nx_sntp_client_receiving_updates* per verificare che il server SNTP stia ancora inviando aggiornamenti validi.</span><span class="sxs-lookup"><span data-stu-id="c28b5-138">The application can poll the SNTP Client using the *nx_sntp_client_receiving_updates* service to verify the SNTP Server is still sending valid updates.</span></span> <span data-ttu-id="c28b5-139">In caso contrario, deve arrestare il thread del client SNTP usando il servizio *nx_sntp_client_stop* e chiamare uno dei due servizi Initialize per impostare un altro indirizzo del server SNTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-139">If not, it should stop the SNTP Client thread using the *nx_sntp_client_stop* service and call either of the two initialize services to set another SNTP Server address.</span></span> <span data-ttu-id="c28b5-140">Per riavviare il client SNTP, l'applicazione chiama *nx_sntp_client_run_broadcast* o *nx_sntp_client_run_unicast*.</span><span class="sxs-lookup"><span data-stu-id="c28b5-140">To restart the SNTP Client, the application calls *nx_sntp_client_run_broadcast* or *nx_sntp_client_run_unicast*.</span></span> <span data-ttu-id="c28b5-141">Si noti che l'applicazione può modificare la modalità operativa del client SNTP nella chiamata di inizializzazione per passare a unicast o broadcast nel modo desiderato.</span><span class="sxs-lookup"><span data-stu-id="c28b5-141">Note that the application can change SNTP Client operating mode in the initialize call to switch to unicast or broadcast as desired.</span></span>

### <a name="local-clock-operation"></a><span data-ttu-id="c28b5-142">Operazione Clock locale</span><span class="sxs-lookup"><span data-stu-id="c28b5-142">Local Clock Operation</span></span>

<span data-ttu-id="c28b5-143">Il tempo di SNTP basato sul numero di secondi sul clock NTP master o sul numero di secondi trascorsi nel primo periodo NTP, ad esempio dal 1 gennaio **1900 00:00:00 al** 1 ° gennaio **1999 00:00:00**.</span><span class="sxs-lookup"><span data-stu-id="c28b5-143">The SNTP time based on the number of seconds on the master NTP clock, or number of seconds elapsed in the first NTP epoch e.g. from Jan 1 **1900 00:00:00 to** Jan 1 **1999 00:00:00**.</span></span> <span data-ttu-id="c28b5-144">Il significato di 01-01-1999 era quello in cui si è verificato l'ultimo salto.</span><span class="sxs-lookup"><span data-stu-id="c28b5-144">The significance of 01-01-1999 was when the last leap second occurred.</span></span> <span data-ttu-id="c28b5-145">Questo valore viene definito come segue:</span><span class="sxs-lookup"><span data-stu-id="c28b5-145">This value is defined as follows:</span></span>

<span data-ttu-id="c28b5-146">\#definire NTP_SECONDS_AT_01011999 0xBA368E80</span><span class="sxs-lookup"><span data-stu-id="c28b5-146">\#define NTP_SECONDS_AT_01011999 0xBA368E80</span></span>

<span data-ttu-id="c28b5-147">Prima di eseguire il client SNTP, l'applicazione può facoltativamente inizializzare l'ora locale del client SNTP per il client da usare come tempo di riferimento.</span><span class="sxs-lookup"><span data-stu-id="c28b5-147">Before the SNTP Client runs, the application can optionally initialize the SNTP Client local time for the Client to use as a baseline time.</span></span> <span data-ttu-id="c28b5-148">A tale scopo, è necessario usare il servizio *nx_sntp_client_set_local_time* .</span><span class="sxs-lookup"><span data-stu-id="c28b5-148">To do so, it must use the *nx_sntp_client_set_local_time* service.</span></span> <span data-ttu-id="c28b5-149">Questa operazione richiede l'ora in formato NTP, secondi e frazione, dove frazioni è il millisecondo nel tempo di riduzione del NTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-149">This takes the time in NTP format, seconds and fraction, where fraction is the milliseconds in the NTP condensed time.</span></span> <span data-ttu-id="c28b5-150">Idealmente l'applicazione può ottenere un SNTP tempo da un'origine indipendente.</span><span class="sxs-lookup"><span data-stu-id="c28b5-150">Ideally the application can obtain an SNTP time from an independent source.</span></span> <span data-ttu-id="c28b5-151">Non è disponibile alcuna API per la conversione di anno, mese, data e ora in un'ora NTP nel client NetX Duo SNTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-151">There is no API for converting year, month, date and time to an NTP time in the NetX Duo SNTP Client.</span></span> <span data-ttu-id="c28b5-152">Per una descrizione del formato dell'ora NTP, vedere *RFC4330 "Simple Network Time Protocol (SNTP) versione 4 per IPv4, IPv6 e OSI".*</span><span class="sxs-lookup"><span data-stu-id="c28b5-152">For a description of NTP time format, refer to *RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI”.*</span></span>

<span data-ttu-id="c28b5-153">Se non viene specificata un'ora locale di base all'avvio del client di SNTP, il client di SNTP accetterà gli aggiornamenti di SNTP senza confrontare l'ora locale al primo aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="c28b5-153">If no base local time is supplied when the SNTP Client starts up, the SNTP Client will accept the SNTP updates without comparing to its local time on the first update.</span></span> <span data-ttu-id="c28b5-154">Successivamente, verranno applicati i valori massimo e minimo di aggiornamento del tempo per determinare se verrà modificata l'ora locale.</span><span class="sxs-lookup"><span data-stu-id="c28b5-154">Thereafter it will apply the maximum and minimum time update values to determine if it will modify its local time.</span></span>

<span data-ttu-id="c28b5-155">Per ottenere l'ora locale del client SNTP, l'applicazione può usare il servizio *nx_sntp_client_get_local_time_extended* .</span><span class="sxs-lookup"><span data-stu-id="c28b5-155">To obtain the SNTP Client local time, the application can use the *nx_sntp_client_get_local_time_extended* service.</span></span>

### <a name="sntp-sanity-checks"></a><span data-ttu-id="c28b5-156">Controlli di integrità SNTP</span><span class="sxs-lookup"><span data-stu-id="c28b5-156">SNTP Sanity Checks</span></span> 

<span data-ttu-id="c28b5-157">Il client esamina il pacchetto in ingresso per i criteri seguenti:</span><span class="sxs-lookup"><span data-stu-id="c28b5-157">The Client examines the incoming packet for the following criteria:</span></span>

  - <span data-ttu-id="c28b5-158">L'indirizzo IP di origine deve corrispondere all'indirizzo IP del server corrente.</span><span class="sxs-lookup"><span data-stu-id="c28b5-158">Source IP address must match the current server IP address.</span></span>

  - <span data-ttu-id="c28b5-159">La porta di origine del mittente deve corrispondere alla porta di origine del server corrente.</span><span class="sxs-lookup"><span data-stu-id="c28b5-159">Sender source port must match with the current server source port.</span></span>

  - <span data-ttu-id="c28b5-160">La lunghezza del pacchetto deve essere la lunghezza minima per contenere un messaggio di ora SNTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-160">Packet length must be the minimum length to hold an SNTP time message.</span></span>

<span data-ttu-id="c28b5-161">Successivamente, i dati relativi all'ora vengono estratti dal buffer dei pacchetti a cui il client applica una serie di "verifiche di integrità" specifiche:</span><span class="sxs-lookup"><span data-stu-id="c28b5-161">Next, the time data is extracted from the packet buffer to which the Client then applies a set of specific ‘sanity checks’:</span></span>

  - <span data-ttu-id="c28b5-162">L'indicatore Leap impostato su 3 indica che il server non è sincronizzato.</span><span class="sxs-lookup"><span data-stu-id="c28b5-162">The Leap Indicator set to 3 indicates the Server is not synchronized.</span></span> <span data-ttu-id="c28b5-163">Il client deve tentare di trovare un server alternativo.</span><span class="sxs-lookup"><span data-stu-id="c28b5-163">The Client should attempt to find an alternative server.</span></span>

  - <span data-ttu-id="c28b5-164">Un campo strato impostato su zero è noto come un pacchetto di un bacio di morte (codice di esempio).</span><span class="sxs-lookup"><span data-stu-id="c28b5-164">A stratum field set to zero is known as a Kiss of Death (KOD) packet.</span></span> <span data-ttu-id="c28b5-165">Il gestore di codice del client SMTP per questa situazione è un callback definito dall'utente.</span><span class="sxs-lookup"><span data-stu-id="c28b5-165">The SMTP Client KOD handler for this situation is a user defined callback.</span></span> <span data-ttu-id="c28b5-166">Il piccolo file demo di esempio contiene un semplice gestore di codice per questa situazione.</span><span class="sxs-lookup"><span data-stu-id="c28b5-166">The small example demo file contains a simple KOD handler for this situation.</span></span> <span data-ttu-id="c28b5-167">Il campo ID di riferimento contiene facoltativamente un codice che indica il motivo della risposta di codice.</span><span class="sxs-lookup"><span data-stu-id="c28b5-167">The Reference ID field optionally contains a code indicating the reason for the KOD reply.</span></span> <span data-ttu-id="c28b5-168">In ogni caso, il gestore di codice deve indicare come gestire la ricezione di un bacio di morte dal server SNTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-168">At any rate, the KOD handler must indicate how to handle receiving a kiss of death from the SNTP Server.</span></span> <span data-ttu-id="c28b5-169">In genere è necessario reinizializzare il client SNTP con un altro server SNTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-169">Typically it will want to reinitialize the SNTP Client with another SNTP Server.</span></span>

  - <span data-ttu-id="c28b5-170">La versione, lo strato e la modalità di funzionamento del server SNTP devono corrispondere al servizio client.</span><span class="sxs-lookup"><span data-stu-id="c28b5-170">The Server SNTP version, stratum and mode of operation must be matched to the Client service.</span></span>

  - <span data-ttu-id="c28b5-171">Se il client è configurato con un valore massimo di dispersione di clock del server, il client controlla la dispersione di clock del server al primo aggiornamento ricevuto e, se supera il numero massimo, il client rifiuta il server.</span><span class="sxs-lookup"><span data-stu-id="c28b5-171">If the Client is configured with a server clock dispersion maximum, the Client checks the server clock dispersion on the first update received only, and if it exceeds the Client maximum, the Client rejects the Server.</span></span>

  - <span data-ttu-id="c28b5-172">I campi timestamp del server devono anche superare controlli specifici.</span><span class="sxs-lookup"><span data-stu-id="c28b5-172">The Server time stamp fields must also pass specific checks.</span></span> <span data-ttu-id="c28b5-173">Per il server unicast, tutti i campi temporali devono essere compilati e non possono essere NULL.</span><span class="sxs-lookup"><span data-stu-id="c28b5-173">For the unicast Server, all time fields must be filled in and cannot be NULL.</span></span> <span data-ttu-id="c28b5-174">Il timestamp di origine deve corrispondere all'indicatore di tempo di trasmissione nella richiesta del messaggio SNTP Time del client.</span><span class="sxs-lookup"><span data-stu-id="c28b5-174">The Origination time stamp must equal the Transmit time stamp in the Client’s SNTP time message request.</span></span> <span data-ttu-id="c28b5-175">In questo modo si protegge il client da intrusioni dannose e dal comportamento dei server non autorizzati.</span><span class="sxs-lookup"><span data-stu-id="c28b5-175">This protects the Client from malicious intruders and rogue Server behavior.</span></span> <span data-ttu-id="c28b5-176">Il server di broadcast deve compilare solo il timestamp di trasmissione.</span><span class="sxs-lookup"><span data-stu-id="c28b5-176">The broadcast Server need only fill in the Transmit time stamp.</span></span> <span data-ttu-id="c28b5-177">Poiché non riceve nulla dal client, non ha alcun campo Receive o origination da compilare.</span><span class="sxs-lookup"><span data-stu-id="c28b5-177">Since it does not receive anything from the Client it has no Receive or Origination fields to fill in.</span></span>

    <span data-ttu-id="c28b5-178">Una verifica di integrità non riuscita i marchi aggiornano l'ora come aggiornamento ora non valido.</span><span class="sxs-lookup"><span data-stu-id="c28b5-178">A failed sanity check brands a time update as an invalid time update.</span></span> <span data-ttu-id="c28b5-179">Il servizio verifica integrità client SNTP tiene traccia del numero di aggiornamenti temporali non validi consecutivi ricevuti dallo stesso server.</span><span class="sxs-lookup"><span data-stu-id="c28b5-179">The SNTP Client sanity check service tracks the number of consecutive invalid time updates received from the same Server.</span></span>

<span data-ttu-id="c28b5-180">Quando l'attività thread client di SNTP verifica la validità di un pacchetto SNTP per l'applicazione al tempo locale del client SNTP, incrementa il conteggio del client SNTP `nx_sntp_client_invalid_time_updates.` . viene inoltre restituito lo stato di errore al chiamante, ma si tratta di un'elaborazione interna che non è immediatamente visibile all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c28b5-180">When SNTP Client thread task checks the validity of an SNTP packet for applying to the local SNTP Client time, it increments the count of the SNTP Client `nx_sntp_client_invalid_time_updates.` It also returns an error status to the caller but this is all internal processing so it is not immediately visible to the application.</span></span> <span data-ttu-id="c28b5-181">Per rilevare gli aggiornamenti in caso di errore, è possibile eseguire una query sul valore del client SNTP `nx_sntp_client_invalid_time_updates` dopo aver ricevuto gli aggiornamenti dell'ora del server di SNTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-181">The way to detect failed time updates is to query the value of the SNTP Client `nx_sntp_client_invalid_time_updates` after receiving SNTP Server time updates.</span></span>

<span data-ttu-id="c28b5-182">Se l'aggiornamento temporale del server supera i controlli di integrità, il client tenta di elaborare i dati temporali nell'ora locale.</span><span class="sxs-lookup"><span data-stu-id="c28b5-182">If the Server time update passes the sanity checks, the Client then attempts to process the time data to its local time.</span></span> <span data-ttu-id="c28b5-183">Se il client è configurato per round trip calcolo, ad esempio il tempo di invio di una richiesta di aggiornamento al momento della ricezione, viene calcolato il tempo di round trip.</span><span class="sxs-lookup"><span data-stu-id="c28b5-183">If the Client is configured for round trip calculation, e.g. the time from sending an update request to the time one is received, the round trip time is calculated.</span></span> <span data-ttu-id="c28b5-184">Questo valore è dimezzato e quindi aggiunto all'ora del server.</span><span class="sxs-lookup"><span data-stu-id="c28b5-184">This value is halved and then added to the Server’s time.</span></span>

<span data-ttu-id="c28b5-185">Se quindi si tratta del primo aggiornamento ricevuto dal server SNTP corrente, il client SNTP determina se ignorare la differenza tra l'ora locale del server e del client.</span><span class="sxs-lookup"><span data-stu-id="c28b5-185">Next, if this is the first update received from the current SNTP Server, the SNTP Client determines if it should ignore the difference between the Server and Client local time.</span></span> <span data-ttu-id="c28b5-186">In seguito, tutti gli aggiornamenti dal server SNTP vengono valutati in base alla differenza con l'ora locale del client.</span><span class="sxs-lookup"><span data-stu-id="c28b5-186">Thereafter all updates from the SNTP Server are evaluated for the difference with the Client local time.</span></span>

<span data-ttu-id="c28b5-187">La differenza tra il client e l'ora del server viene confrontata con `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT` .</span><span class="sxs-lookup"><span data-stu-id="c28b5-187">The difference between Client and Server time is compared with `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT`.</span></span> <span data-ttu-id="c28b5-188">Se supera questo valore, i dati vengono eliminati. Se la differenza è inferiore `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT` a, la differenza viene considerata troppo piccola per richiedere la regolazione.</span><span class="sxs-lookup"><span data-stu-id="c28b5-188">If it exceeds this value, the data is thrown out. If the difference is less than the `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT` the difference is considered too small to require adjustment.</span></span>

<span data-ttu-id="c28b5-189">Passando tutti questi controlli, l'aggiornamento ora viene applicato al client SNTP con alcune correzioni per i ritardi nell'elaborazione client SNTP interna.</span><span class="sxs-lookup"><span data-stu-id="c28b5-189">Passing all these checks, the time update is then applied to the SNTP Client with some corrections for delays in internal SNTP Client processing.</span></span>

### <a name="sntp-asynchronous-unicast-requests"></a><span data-ttu-id="c28b5-190">Richieste unicast asincrone SNTP</span><span class="sxs-lookup"><span data-stu-id="c28b5-190">SNTP Asynchronous Unicast Requests</span></span> 

<span data-ttu-id="c28b5-191">Il client SNTP consente all'applicazione host di inviare in modo asincrono una richiesta unicast per l'ora corrente dal server NTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-191">The SNTP Client allows the host application to asynchronously send a unicast request for the current time from the NTP server.</span></span>

```C
UINT _nx_sntp_client_request_unicast_time(
NX_SNTP_CLIENT *client_ptr, 
UINT wait_option)
```

<span data-ttu-id="c28b5-192">L'opzione Wait è la scadenza per l'attesa di una risposta.</span><span class="sxs-lookup"><span data-stu-id="c28b5-192">The wait option is the expiration to wait for a response.</span></span>

<span data-ttu-id="c28b5-193">Se il server NTP risponde, il pacchetto viene sottoposto alla stessa elaborazione e ai controlli di integrità, come descritto nella sezione precedente, prima di aggiornare l'ora locale del client SNTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-193">If the NTP Server responds, the packet is subjected to the same processing and sanity checks as described in the previous section before updating the SNTP Client local time.</span></span>

<span data-ttu-id="c28b5-194">Se la chiamata restituisce un esito positivo, l'applicazione può chiamare *nx_sntp_client_utility_display_date_time* o *nx_sntp_client_get_local_time_extended* per l'ora locale aggiornata.</span><span class="sxs-lookup"><span data-stu-id="c28b5-194">If the call returns successful completion, the application can call *nx_sntp_client_utility_display_date_time* or *nx_sntp_client_get_local_time_extended* for the updated local time.</span></span>

<span data-ttu-id="c28b5-195">Queste richieste unicast non interferiscono con la normale pianificazione client di SNTP per l'invio della richiesta unicast successiva o in modalità broadcast, quando si prevede la successiva trasmissione NTP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-195">These unicast requests do not interfere with the normal SNTP Client schedule for sending the next unicast request, or if in broadcast mode, when to expect the next NTP broadcast.</span></span>

### <a name="periodic-local-time-updates"></a><span data-ttu-id="c28b5-196">Aggiornamenti periodici dell'ora locale</span><span class="sxs-lookup"><span data-stu-id="c28b5-196">Periodic Local Time Updates</span></span>

<span data-ttu-id="c28b5-197">La regolazione massima dell'ora locale è impostata nell'opzione NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT (in millisecondi).</span><span class="sxs-lookup"><span data-stu-id="c28b5-197">The maximum adjustment to the local time is set in the NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT option (in milliseconds).</span></span> <span data-ttu-id="c28b5-198">L'intervallo di aggiornamento di polling per le operazioni client unicast SNTP è impostato nell'opzione NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL (in secondi).</span><span class="sxs-lookup"><span data-stu-id="c28b5-198">The polling update interval for unicast SNTP Client operations is set in the NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL option (in seconds).</span></span> <span data-ttu-id="c28b5-199">Se l'intervallo di polling è maggiore della regolazione massima, gli aggiornamenti successivi del server dopo l'aggiornamento del primo server verranno rifiutati.</span><span class="sxs-lookup"><span data-stu-id="c28b5-199">If the polling interval is greater than the maximum adjustment, then subsequent server updates after the first server update will be rejected.</span></span> <span data-ttu-id="c28b5-200">Per evitare che ciò accada, il client SNTP aggiornerà l'ora locale definita periodicamente come NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span><span class="sxs-lookup"><span data-stu-id="c28b5-200">To prevent this, the SNTP Client will update the local time periodically defined as NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span></span> 

<span data-ttu-id="c28b5-201">Se c'è una differenza di tempo tra l'RTC in bacheca e l'ora del server (che l'ora locale del client di SNTP deve essere impostata su), il RTC deve essere sincronizzato con il tempo client di SNTP (non viene illustrato in questo manuale dell'utente).</span><span class="sxs-lookup"><span data-stu-id="c28b5-201">If there is a difference in time between the on board RTC and the server time (which the SNTP Client local time should be set to), the RTC should be synched to the SNTP Client time (we do not demonstrate that in this User Guide).</span></span>

<span data-ttu-id="c28b5-202">Poiché gli aggiornamenti del server SNTP non devono essere eseguiti più spesso di una volta all'ora, non è utile eseguire il polling del client di SNTP per gli aggiornamenti del server o lo stato del server più spesso.</span><span class="sxs-lookup"><span data-stu-id="c28b5-202">Since SNTP server updates should not occur more often than once per hour, it is not useful to poll the SNTP Client for server updates or server status more often than that.</span></span> <span data-ttu-id="c28b5-203">Tuttavia, il client di SNTP deve aggiornare il clock locale abbastanza spesso da non superare il parametro di regolazione del tempo massimo NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span><span class="sxs-lookup"><span data-stu-id="c28b5-203">However, the SNTP Client should update its local clock often enough not to fall further than the maximum time adjustment parameter NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span></span>

<span data-ttu-id="c28b5-204">In alternativa, il NX_SNTP_CLIENT_MAX_TIME_LAPSE di regolazione massima può essere impostato su un valore maggiore rispetto all'aggiornamento di polling unicast (o a intervalli di trasmissione previsti).</span><span class="sxs-lookup"><span data-stu-id="c28b5-204">Alternatively, the maximum adjustment NX_SNTP_CLIENT_MAX_TIME_LAPSE can be set to greater than the unicast polling update (or anticipated broadcast intervals).</span></span> <span data-ttu-id="c28b5-205">Il secondo Elimina la necessità di un clock in tempo reale indipendente.</span><span class="sxs-lookup"><span data-stu-id="c28b5-205">The latter eliminates the need for an independent real time clock.</span></span> <span data-ttu-id="c28b5-206">Tuttavia, l'intento del protocollo SNTP è evitare la dipendenza totale dagli aggiornamenti locali dell'RTC o della rete.</span><span class="sxs-lookup"><span data-stu-id="c28b5-206">However, the intention of SNTP protocol is to avoid total reliance on either local RTC or network time updates.</span></span> <span data-ttu-id="c28b5-207">Inoltre, gli aggiornamenti del server SNTP sono destinati a impedire la deriva nell'orologio orario locale.</span><span class="sxs-lookup"><span data-stu-id="c28b5-207">Further, the SNTP Server updates are intended to prevent drift in the local time clock.</span></span>

## <a name="multiple-network-interfaces"></a><span data-ttu-id="c28b5-208">Più interfacce di rete</span><span class="sxs-lookup"><span data-stu-id="c28b5-208">Multiple Network Interfaces</span></span>

<span data-ttu-id="c28b5-209">NetX Duo SNTP client può essere configurato per l'esecuzione in reti secondarie purché tali reti siano registrate con l'istanza IP.</span><span class="sxs-lookup"><span data-stu-id="c28b5-209">NetX Duo SNTP Client can be configured to run on secondary networks as long as those networks are registered with the IP instance.</span></span> <span data-ttu-id="c28b5-210">Per ulteriori informazioni su come registrare le reti secondarie, vedere il manuale dell'utente di NetX Duo o NetX.</span><span class="sxs-lookup"><span data-stu-id="c28b5-210">See the NetX Duo or NetX User Guide for more information on how to register secondary networks.</span></span>

<span data-ttu-id="c28b5-211">Nella chiamata *nx_sntp_client_create* impostare il terzo input, iface_index, sull'indice della rete per il client SNTP per la ricezione degli aggiornamenti temporali in.</span><span class="sxs-lookup"><span data-stu-id="c28b5-211">In the *nx_sntp_client_create* call, set the third input, iface_index, to the index of the network for the SNTP Client to receive time updates on.</span></span> <span data-ttu-id="c28b5-212">L'interfaccia primaria è sempre in corrispondenza dell'indice 0.</span><span class="sxs-lookup"><span data-stu-id="c28b5-212">The primary interface is always at index 0.</span></span> <span data-ttu-id="c28b5-213">NetX Duo SNTP client non può supportare gli aggiornamenti temporali simultaneamente su più interfacce di rete.</span><span class="sxs-lookup"><span data-stu-id="c28b5-213">NetX Duo SNTP Client cannot support time updates simultaneously on multiple network interface.</span></span>

## <a name="sntp-and-ntp-rfcs"></a><span data-ttu-id="c28b5-214">RFC SNTP e NTP</span><span class="sxs-lookup"><span data-stu-id="c28b5-214">SNTP and NTP RFCs</span></span>

<span data-ttu-id="c28b5-215">NetX Duo SNTP client è conforme a RFC4330 "Simple Network Time Protocol (SNTP) versione 4 per IPv4, IPv6 e OSI" e RFC correlati.</span><span class="sxs-lookup"><span data-stu-id="c28b5-215">NetX Duo SNTP client is compliant with RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI” and related RFCs.</span></span>