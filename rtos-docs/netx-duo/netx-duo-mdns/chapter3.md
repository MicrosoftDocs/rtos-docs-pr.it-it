---
title: Capitolo 3-Descrizione della cache interna del servizio
description: 'Il modulo NetX Duo MDN gestisce due cache dei servizi interni: la cache del servizio locale e la cache del servizio peer.'
author: philmea
ms.author: philmea
ms.date: 07/09/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 007f1080a076730cfbcdedc9f063ac0c427a414c
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/22/2021
ms.locfileid: "104821818"
---
# <a name="chapter-3---description-of-internal-service-cache"></a><span data-ttu-id="4677f-103">Capitolo 3-Descrizione della cache interna del servizio</span><span class="sxs-lookup"><span data-stu-id="4677f-103">Chapter 3 - Description of internal service cache</span></span>

<span data-ttu-id="4677f-104">Il modulo NetX Duo MDN gestisce due cache dei servizi interni: la cache del servizio locale e la cache del servizio peer.</span><span class="sxs-lookup"><span data-stu-id="4677f-104">NetX Duo mDNS module manages two internal services caches: the local service cache, and the peer service cache.</span></span> <span data-ttu-id="4677f-105">La cache del servizio locale archivia i record di risorse correlati ai servizi offerti dalle applicazioni in esecuzione nel nodo.</span><span class="sxs-lookup"><span data-stu-id="4677f-105">The local service cache stores Resource Records related to services offered by applications running on the node.</span></span> <span data-ttu-id="4677f-106">Per le query in ingresso, se la domanda corrisponde al servizio offerto, risposte MDN con risposte memorizzate nella cache del servizio locale.</span><span class="sxs-lookup"><span data-stu-id="4677f-106">For incoming queries, if the question matches the service offered, mDNS responses with answers stored in the local service cache.</span></span> <span data-ttu-id="4677f-107">Le applicazioni registrano i servizi chiamando l'API *nx_mdns_service_add ()*.</span><span class="sxs-lookup"><span data-stu-id="4677f-107">Applications register services by calling the API *nx_mdns_service_add()*.</span></span> <span data-ttu-id="4677f-108">Per rimuovere i servizi, le applicazioni usano l'API *nx_mdns_service_delete ()*, che a sua volta inviano messaggi "Goodbye" prima di rimuovere le voci corrispondenti nella cache del servizio locale.</span><span class="sxs-lookup"><span data-stu-id="4677f-108">To remove services, applications use the API *nx_mdns_service_delete()*, which will in turn send "goodbye" messages before removing the corresponding entries in the local service cache.</span></span>

<span data-ttu-id="4677f-109">Quando viene aggiunto un servizio, MDN gestisce almeno 3 record di risorse nella cache del servizio locale: SRV, PTR e TXT.</span><span class="sxs-lookup"><span data-stu-id="4677f-109">When a service is added, mDNS maintains at least 3 Resource Records in the local service cache: SRV, PTR, and TXT.</span></span> <span data-ttu-id="4677f-110">È possibile aggiungere un record di risorse PTR aggiuntivo se il tipo di servizio include il sottotipo.</span><span class="sxs-lookup"><span data-stu-id="4677f-110">Additional PTR Resource Record may be added if the service type includes subtype.</span></span> <span data-ttu-id="4677f-111">Ad esempio, un'applicazione registra un servizio:</span><span class="sxs-lookup"><span data-stu-id="4677f-111">For example, an application registers a service:</span></span>

```
*name*._*subtype*._sub._*type*._tcp.local,
```

<span data-ttu-id="4677f-112">due record di risorse PTR vengono aggiunti alla cache del servizio locale, uno per</span><span class="sxs-lookup"><span data-stu-id="4677f-112">two PTR Resource Records are added to the local service cache, one for</span></span>

```
“*_subtype._*sub*._type._*tcp.local *PTR name.type._*tcp*.*local”
```

<span data-ttu-id="4677f-113">e l'altro per</span><span class="sxs-lookup"><span data-stu-id="4677f-113">and the other one for</span></span>

```
*“_type._*tcp*.*local *PTR name.type._*tcp*.*local”.
```

<span data-ttu-id="4677f-114">La cache del servizio peer contiene i record di risorse MDN ricevuti dai nodi adiacenti.</span><span class="sxs-lookup"><span data-stu-id="4677f-114">The peer service cache contains mDNS Resource Records received from neighboring nodes.</span></span> <span data-ttu-id="4677f-115">il modulo MDN raccoglie i record di risorse annunciati da altri nodi nella rete e archivia le informazioni ricevute nella cache dei servizi peer.</span><span class="sxs-lookup"><span data-stu-id="4677f-115">mDNS module collects Resource Records advertised by other nodes on the network, and stores the received information in the peer service cache.</span></span> <span data-ttu-id="4677f-116">Quando l'applicazione esegue query su informazioni quali indirizzi IPv4 o IPv6 host, MDN Cerca nella cache del servizio peer le risposte memorizzate nella cache locale.</span><span class="sxs-lookup"><span data-stu-id="4677f-116">When application queries for information such as host IPv4 or IPv6 addresses, mDNS searches the peer service cache for locally cached responses.</span></span> <span data-ttu-id="4677f-117">Quando l'applicazione esegue query per i servizi offerti da peer, MDN Cerca nella cache i record di indirizzi PTR, SRV, TXT e IPv4/IPv6 correlati.</span><span class="sxs-lookup"><span data-stu-id="4677f-117">When application queries for services offered by peers, mDNS searches through the cache for related PTR, SRV, TXT, and IPv4/IPv6 address records.</span></span> <span data-ttu-id="4677f-118">La cache del servizio peer archivia anche le query inviate al nodo.</span><span class="sxs-lookup"><span data-stu-id="4677f-118">The peer service cache also stores queries sent to the node.</span></span> <span data-ttu-id="4677f-119">Ad esempio, un'applicazione può richiedere un particolare servizio chiamando *nx_mdns_service_one_shot_query.*</span><span class="sxs-lookup"><span data-stu-id="4677f-119">For example, an application may request a particular service by calling *nx_mdns_service_one_shot_query.*</span></span> <span data-ttu-id="4677f-120">Se il servizio non viene trovato nella cache dei servizi peer, MDN crea domande di query (PTR, SRV e TXT) nella cache del servizio peer.</span><span class="sxs-lookup"><span data-stu-id="4677f-120">If the service is not found in the peer service cache, mDNS creates query questions (PTR, SRV, and TXT) in the peer service cache.</span></span> <span data-ttu-id="4677f-121">Queste domande di query verranno inviate periodicamente alla rete fino a quando il servizio non viene risolto o si verifica il timeout. Analogamente, l'applicazione può usare l'API *nx_mdns_service_continous_query ()* per richiedere un particolare servizio in un lungo periodo di tempo (l'applicazione annulla una query continua rilasciata in precedenza tramite l'API *nx_mdns_service_query_stop ()* ).</span><span class="sxs-lookup"><span data-stu-id="4677f-121">These query questions will be sent to the network periodically till the service is resolved, or times out. Similar, the application may use the API *nx_mdns_service_continous_query()* to request a particular service over a long period of time (application cancels a previously issued continuous query by using the API *nx_mdns_service_query_stop()* ).</span></span> <span data-ttu-id="4677f-122">Per cercare un servizio specifico nella cache del servizio peer senza inviare query alla rete, le applicazioni possono usare l'API *nx_mdns_serivce_lookup ().*</span><span class="sxs-lookup"><span data-stu-id="4677f-122">To search for a particular service in the peer service cache without sending queries to the network, applications can use the API *nx_mdns_serivce_lookup().*</span></span> <span data-ttu-id="4677f-123">Questa API cerca solo i record di risorse nella cache dei servizi peer.</span><span class="sxs-lookup"><span data-stu-id="4677f-123">This API only searches the resource records in the peer service cache.</span></span>

<span data-ttu-id="4677f-124">Ogni record di risorse viene archiviato in una struttura di dati *NX_MDNS_RR* nelle cache dei servizi.</span><span class="sxs-lookup"><span data-stu-id="4677f-124">Each Resource Record is stored in a data structure *NX_MDNS_RR* in the service caches.</span></span> <span data-ttu-id="4677f-125">Le stringhe nei record di risorse sono a lunghezza variabile e pertanto non sono archiviate nella struttura di *NX_MDNS_RR* .</span><span class="sxs-lookup"><span data-stu-id="4677f-125">Strings in Resource Records are variable length, therefore are not stored in the *NX_MDNS_RR* structure.</span></span> <span data-ttu-id="4677f-126">Il record di risorse contiene un puntatore alla posizione di memoria effettiva in cui è archiviata la stringa.</span><span class="sxs-lookup"><span data-stu-id="4677f-126">The Resource Record contains a pointer to the actual memory location where the string is stored.</span></span> <span data-ttu-id="4677f-127">La tabella delle stringhe e i record di risorse condividono la cache del servizio.</span><span class="sxs-lookup"><span data-stu-id="4677f-127">The string table and the Resource Records share the service cache.</span></span> <span data-ttu-id="4677f-128">I record di risorse vengono archiviati dall'inizio della cache del servizio e aumentano verso la fine della cache.</span><span class="sxs-lookup"><span data-stu-id="4677f-128">Resource Records are stored from the beginning of the service cache, and grow towards the end of the cache.</span></span> <span data-ttu-id="4677f-129">La tabella delle stringhe inizia dalla fine della cache del servizio e aumenta verso l'inizio della cache.</span><span class="sxs-lookup"><span data-stu-id="4677f-129">The string table starts from the end of the service cache and grows towards the beginning of the cache.</span></span> <span data-ttu-id="4677f-130">Ogni stringa nella tabella di stringhe ha un campo lunghezza e un campo contatore.</span><span class="sxs-lookup"><span data-stu-id="4677f-130">Each string in the string table has a length field and a counter field.</span></span> <span data-ttu-id="4677f-131">Quando una stringa viene aggiunta alla tabella delle stringhe, se la stessa stringa è già presente nella tabella, il valore del contatore viene incrementato e non viene allocata alcuna memoria per la stringa.</span><span class="sxs-lookup"><span data-stu-id="4677f-131">When a string is added to the string table, if the same string is already present in the table, the counter value is incremented and no memory is allocated for the string.</span></span> <span data-ttu-id="4677f-132">La cache del servizio è considerata completa se non è possibile aggiungere più record di risorse o nuove stringhe alla cache del servizio.</span><span class="sxs-lookup"><span data-stu-id="4677f-132">The service cache is considered full if no more resource records or new strings can be added to the service cache.</span></span>

<span data-ttu-id="4677f-133">Esistono due modi per trovare i servizi offerti nella rete locale da parte di un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4677f-133">There are two ways for an application to find services offered on the local network.</span></span> <span data-ttu-id="4677f-134">Può emettere una ricerca di un servizio specifico tramite una query di tipo One-Shot oppure può avviare una query continua per "monitorare" le attività sulla rete.</span><span class="sxs-lookup"><span data-stu-id="4677f-134">It can either issue a specific service look up through a one-shot query, or it can initiate a continuous query to “monitor” the activities on the network.</span></span> <span data-ttu-id="4677f-135">In uno scenario di query a breve, l'applicazione deve specificare il tipo di servizio.</span><span class="sxs-lookup"><span data-stu-id="4677f-135">In the one-short query scenario, the application must specify the service type.</span></span> <span data-ttu-id="4677f-136">MDN esegue la ricerca attraverso la cache del servizio locale e la cache del servizio peer.</span><span class="sxs-lookup"><span data-stu-id="4677f-136">mDNS searches through the local service cache and the peer service cache.</span></span> <span data-ttu-id="4677f-137">Se viene individuata un'istanza del servizio, la query monouso restituisce le informazioni contenute nei record di risorse.</span><span class="sxs-lookup"><span data-stu-id="4677f-137">If a service instances is located, the one-shot query returns with the information found in the Resource Records.</span></span> <span data-ttu-id="4677f-138">Se nella cache del servizio locale o nella cache del servizio peer non sono presenti record, MDN invia messaggi di query.</span><span class="sxs-lookup"><span data-stu-id="4677f-138">If there are no records in the local service cache or peer service cache, mDNS sends out query messages.</span></span> <span data-ttu-id="4677f-139">Se viene specificato il nome dell'istanza, un *qualsiasi* tipo (eseguire una query sul tipo SRV e txt) con il nome dell'istanza specifico, nel formato "nome. Type. local", viene inviato alla rete locale.</span><span class="sxs-lookup"><span data-stu-id="4677f-139">If the instance name is specified, an *ANY* type (query the SRV and TXT type) with the specific instance name, in the form of “name.type.local”, is sent to the local network.</span></span> <span data-ttu-id="4677f-140">Se il nome dell'istanza non è specificato, viene inviato un tipo di query PTR alla rete locale.</span><span class="sxs-lookup"><span data-stu-id="4677f-140">If the instance name is not specified, a PTR type of query is sent to the local network.</span></span> <span data-ttu-id="4677f-141">Il primo servizio completo ricevuto viene restituito al chiamante.</span><span class="sxs-lookup"><span data-stu-id="4677f-141">The first complete service received is returned to the caller.</span></span>

<span data-ttu-id="4677f-142">La query continua funziona in modo diverso.</span><span class="sxs-lookup"><span data-stu-id="4677f-142">Continuous query works differently.</span></span> <span data-ttu-id="4677f-143">Il caso d'uso tipico per una query continua consiste nel monitorare la rete locale per un servizio specifico, ad esempio per cercare costantemente i servizi di stampa nella rete locale.</span><span class="sxs-lookup"><span data-stu-id="4677f-143">The typical use case for a continuous query is to monitor the local network for a specific service (for example to constantly look for printing services on the local network).</span></span> <span data-ttu-id="4677f-144">In questo caso l'applicazione esegue una query di ricerca (tramite la query API *nx_mdns_service_continious_*) per determinati tipi di servizi.</span><span class="sxs-lookup"><span data-stu-id="4677f-144">In this case the application issues a search query (via the API *nx_mdns_service_continious_* query) for certain type of services.</span></span> <span data-ttu-id="4677f-145">Il chiamante in genere non attende una determinata risposta.</span><span class="sxs-lookup"><span data-stu-id="4677f-145">The caller typically does not wait for a particular response.</span></span> <span data-ttu-id="4677f-146">Per le query inviate come query continua, il modulo MDN trasmette periodicamente le query con intervalli esponenzialmente crescenti.</span><span class="sxs-lookup"><span data-stu-id="4677f-146">For queries submitted as continuous query, the mDNS module transmits the queries periodically with exponentially increasing intervals.</span></span> <span data-ttu-id="4677f-147">Per arrestare la query, l'applicazione deve usare l'API *nx_mdns_service_query_stop* per arrestare il timer interno in queste query.</span><span class="sxs-lookup"><span data-stu-id="4677f-147">To stop the query, application must use the API *nx_mdns_service_query_stop* to stop the internal timer in these queries.</span></span> <span data-ttu-id="4677f-148">Il tipo di query può essere NULL, nel qual caso il tipo di query è impostato su speciale tipo PTR "_services. _dns-SD. _udp. local".</span><span class="sxs-lookup"><span data-stu-id="4677f-148">The query type can be NULL, in which case the query type is set to special PTR type “_services._dns-sd._udp.local”.</span></span> <span data-ttu-id="4677f-149">Questo tipo di servizio è definito da MDN come modo per individuare tutti i servizi disponibili nella rete locale.</span><span class="sxs-lookup"><span data-stu-id="4677f-149">This service type is defined by mDNS as a way to discover all services available on the local network.</span></span> <span data-ttu-id="4677f-150">Se viene specificato il nome dell'istanza, alla rete locale viene inviato un qualsiasi tipo (eseguire una query sul tipo SRV e TXT) con il nome di istanza specifico "Name. Type. local".</span><span class="sxs-lookup"><span data-stu-id="4677f-150">If the instance name is supplied, an ANY type (query the SRV and TXT type) with the specific instance name “name.type.local” is sent to the local network.</span></span> <span data-ttu-id="4677f-151">Se il nome dell'istanza è NULL, viene inviato un tipo di query PTR alla rete locale.</span><span class="sxs-lookup"><span data-stu-id="4677f-151">If the instance name is NULL, a PTR type of query is sent to the local network,</span></span>

<span data-ttu-id="4677f-152">Tutte le risposte, incluse le risposte da query non richieste, vengono registrate nella cache dei servizi peer.</span><span class="sxs-lookup"><span data-stu-id="4677f-152">All responses, including responses from unsolicited queries, are recorded in the peer service cache.</span></span> <span data-ttu-id="4677f-153">In un secondo momento, l'applicazione utilizza l'API *nx_mdns_service_lookup* per recuperare un servizio specifico dalla cache del servizio peer.</span><span class="sxs-lookup"><span data-stu-id="4677f-153">At a later time, the application uses the API *nx_mdns_service_lookup* to retrieve specific service from the peer service cache.</span></span>

<span data-ttu-id="4677f-154">Nota speciale sulla frammentazione: ogni *NX_MDNS_RR* struttura è di dimensioni fisse e pertanto non è soggetta a frammentazione quando MDN aggiunge ed Elimina RRS.</span><span class="sxs-lookup"><span data-stu-id="4677f-154">Special note on fragmentation: Each *NX_MDNS_RR* structure is fixed in size, and therefore is not subject to fragmentation as mDNS adds and deletes RRs.</span></span> <span data-ttu-id="4677f-155">Tuttavia, le stringhe sono a lunghezza variabile.</span><span class="sxs-lookup"><span data-stu-id="4677f-155">However strings are variable length.</span></span> <span data-ttu-id="4677f-156">Dopo l'eliminazione di una stringa, lo spazio diventa disponibile e potrebbe essere usato per una nuova stringa se la nuova stringa può adattarsi.</span><span class="sxs-lookup"><span data-stu-id="4677f-156">After a string is deleted, the space becomes available and could be used for a new string if the new string is able to fit in.</span></span> <span data-ttu-id="4677f-157">Questa operazione comporta tuttavia la frammentazione della memoria.</span><span class="sxs-lookup"><span data-stu-id="4677f-157">But this operation causes the memory to fragment.</span></span> <span data-ttu-id="4677f-158">Quando i servizi vengono aggiunti e rimossi, la tabella delle stringhe può essere frammentata nel punto in cui non è possibile aggiungere nuove stringhe anche se la cache del servizio contiene un numero sufficiente di byte non utilizzati per la stringa.</span><span class="sxs-lookup"><span data-stu-id="4677f-158">As services are added and removed, the string table may be fragmented to the point that no new strings can be added even though the service cache contains enough unused bytes for the string.</span></span> <span data-ttu-id="4677f-159">Le applicazioni locali tendono a essere più stabili e prevedibili.</span><span class="sxs-lookup"><span data-stu-id="4677f-159">Local applications tend to be more stable and predictable.</span></span> <span data-ttu-id="4677f-160">Pertanto è meno probabile che la cache del servizio locale soffra di frammentazione.</span><span class="sxs-lookup"><span data-stu-id="4677f-160">Therefore the local service cache is less likely to suffer from fragmentation.</span></span> <span data-ttu-id="4677f-161">La cache del servizio peer, d'altra parte, aggiunge costantemente RRs quando i servizi diventano disponibili o rimuove RRs come i servizi vengono eliminati dai nodi sulla rete.</span><span class="sxs-lookup"><span data-stu-id="4677f-161">The peer service cache, on the other hand, constantly add RRs as the services become available, or remove RRs as services are deleted by the nodes on the network.</span></span> <span data-ttu-id="4677f-162">I servizi sulla rete sono disponibili, causando operazioni di allocazione/eliminazione più frequenti nella tabella di stringhe.</span><span class="sxs-lookup"><span data-stu-id="4677f-162">Services on the network come and go, causing more frequent allocate/delete operations on the string table.</span></span> <span data-ttu-id="4677f-163">Nel tempo è possibile che la tabella delle stringhe diventi frammentata.</span><span class="sxs-lookup"><span data-stu-id="4677f-163">Over time it is possible the string table becomes fragmented.</span></span> <span data-ttu-id="4677f-164">Quando si verifica questa situazione, una soluzione semplice consiste nello scaricare l'intera cache del servizio peer.</span><span class="sxs-lookup"><span data-stu-id="4677f-164">When this situation happens, a simple solution is to flush the entire peer service cache.</span></span> <span data-ttu-id="4677f-165">Questa operazione può essere eseguita chiamando l'API *nx_mdns_peer_cache_clear ().*</span><span class="sxs-lookup"><span data-stu-id="4677f-165">This can be done by calling the API *nx_mdns_peer_cache_clear().*</span></span> <span data-ttu-id="4677f-166">Si noti che questa API termina automaticamente le query continue in attesa.</span><span class="sxs-lookup"><span data-stu-id="4677f-166">Note that this API automatically terminates any outstanding continuous queries.</span></span>
