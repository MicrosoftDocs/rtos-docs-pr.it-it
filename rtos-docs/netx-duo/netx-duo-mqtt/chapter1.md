---
title: Capitolo 1-Introduzione ad Azure RTO NetX Duo MQTT
description: Per il pacchetto client NetX Duo MQTT è necessario che NetX Duo (versione 5,10 o successiva) sia installato, configurato correttamente e che sia stata creata l'istanza IP.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 2e13b997f987e2fd82569bcb1904218908313d70
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/22/2021
ms.locfileid: "104821815"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-mqtt"></a><span data-ttu-id="95fbf-103">Capitolo 1-Introduzione ad Azure RTO NetX Duo MQTT</span><span class="sxs-lookup"><span data-stu-id="95fbf-103">Chapter 1 - Introduction to Azure RTOS NetX Duo MQTT</span></span>

## <a name="netx-duo-mqtt-requirements"></a><span data-ttu-id="95fbf-104">Requisiti di NetX Duo MQTT</span><span class="sxs-lookup"><span data-stu-id="95fbf-104">NetX Duo MQTT Requirements</span></span>

<span data-ttu-id="95fbf-105">Il pacchetto client di Azure RTO NetX Duo MQTT richiede l'installazione, la configurazione corretta e la creazione dell'istanza IP di NetX Duo (versione 5,10 o successiva).</span><span class="sxs-lookup"><span data-stu-id="95fbf-105">The Azure RTOS NetX Duo MQTT client package requires that NetX Duo (version 5.10 or later) be installed, properly configured, and the IP instance has been created.</span></span> <span data-ttu-id="95fbf-106">Il modulo TCP deve essere abilitato nel sistema.</span><span class="sxs-lookup"><span data-stu-id="95fbf-106">The TCP module must be enabled in the system.</span></span> <span data-ttu-id="95fbf-107">Inoltre, se è necessaria la sicurezza TLS, è necessario configurare il modulo TLS sicuro NetX in base al parametro di sicurezza richiesto dal broker.</span><span class="sxs-lookup"><span data-stu-id="95fbf-107">In addition, if TLS security is required, the NetX Secure TLS module needs to be configured according to the security parameter required by the broker.</span></span>

## <a name="netx-duo-mqtt-specification"></a><span data-ttu-id="95fbf-108">Specifica MQTT di NetX Duo</span><span class="sxs-lookup"><span data-stu-id="95fbf-108">NetX Duo MQTT Specification</span></span>

<span data-ttu-id="95fbf-109">NetX Duo MQTT client implementate è conforme a OASIS MQTT versione 3.1.1 ottobre 29<sup>°</sup> 2014.</span><span class="sxs-lookup"><span data-stu-id="95fbf-109">NetX Duo MQTT client implement is compliant with OASIS MQTT Version 3.1.1 Oct 29<sup>th</sup> 2014.</span></span> <span data-ttu-id="95fbf-110">La specifica si trova in:</span><span class="sxs-lookup"><span data-stu-id="95fbf-110">The specification can be found at:</span></span>

- [http://mqtt.org/](http://mqtt.org/)

## <a name="netx-duo-mqtt-basic-operation"></a><span data-ttu-id="95fbf-111">Operazione di base di NetX Duo MQTT</span><span class="sxs-lookup"><span data-stu-id="95fbf-111">NetX Duo MQTT Basic Operation</span></span>

<span data-ttu-id="95fbf-112">MQTT (trasporto di telemetria della coda di messaggi) si basa sul modello del Sottoscrittore di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="95fbf-112">MQTT (Message Queue Telemetry Transport) is based on publisher-subscriber model.</span></span> <span data-ttu-id="95fbf-113">Un client può pubblicare informazioni ad altri client tramite un broker.</span><span class="sxs-lookup"><span data-stu-id="95fbf-113">A client can publish information to other clients through a broker.</span></span> <span data-ttu-id="95fbf-114">Un client, se interessato a un argomento, può sottoscrivere l'argomento tramite il broker.</span><span class="sxs-lookup"><span data-stu-id="95fbf-114">A client, if interested in a topic, can subscribe to the topic through the broker.</span></span> <span data-ttu-id="95fbf-115">Un broker è responsabile della distribuzione dei messaggi pubblicati ai client che sottoscrivono l'argomento.</span><span class="sxs-lookup"><span data-stu-id="95fbf-115">A broker is responsible for delivering published messages to its clients who subscribe to the topic.</span></span> <span data-ttu-id="95fbf-116">In questo modello di server di pubblicazione-Sottoscrittore, più client possono pubblicare dati con lo stesso argomento.</span><span class="sxs-lookup"><span data-stu-id="95fbf-116">In this publisher-subscriber model, multiple clients may publish data with the same topic.</span></span> <span data-ttu-id="95fbf-117">Un client riceverà un messaggio pubblicato se il client sottoscrive lo stesso argomento.</span><span class="sxs-lookup"><span data-stu-id="95fbf-117">A client will receive a message it publishes if the client subscribes to the same topic.</span></span>

<span data-ttu-id="95fbf-118">A seconda del caso di utilizzo, un client può scegliere uno dei tre livelli di QoS durante la pubblicazione di un messaggio:</span><span class="sxs-lookup"><span data-stu-id="95fbf-118">Depending on the use case, a client may choose one of the 3 QoS levels when publishing a message:</span></span>

- <span data-ttu-id="95fbf-119">**QoS 0**: il messaggio viene recapitato al massimo una volta.</span><span class="sxs-lookup"><span data-stu-id="95fbf-119">**QoS 0**: The message is delivered at most once.</span></span> <span data-ttu-id="95fbf-120">I messaggi inviati con QoS 0 potrebbero andare persi.</span><span class="sxs-lookup"><span data-stu-id="95fbf-120">Messages sent with QoS 0 may be lost.</span></span>
- <span data-ttu-id="95fbf-121">**QoS 1**: il messaggio viene recapitato almeno una volta.</span><span class="sxs-lookup"><span data-stu-id="95fbf-121">**QoS 1**: The message is delivered at least once.</span></span> <span data-ttu-id="95fbf-122">I messaggi inviati con QoS 1 possono essere recapitati più di una volta.</span><span class="sxs-lookup"><span data-stu-id="95fbf-122">Messages sent with QoS 1 may be delivered more than once.</span></span>
- <span data-ttu-id="95fbf-123">**QoS 2**: il messaggio viene recapitato una sola volta.</span><span class="sxs-lookup"><span data-stu-id="95fbf-123">**QoS 2**: The message is delivered exactly once.</span></span> <span data-ttu-id="95fbf-124">È garantito che i messaggi inviati con QoS 2 siano recapitati senza duplicati.</span><span class="sxs-lookup"><span data-stu-id="95fbf-124">Messages sent with QoS 2 is guaranteed to be delivered, with no duplication.</span></span>

> [!NOTE]
> <span data-ttu-id="95fbf-125">Questa implementazione del client MQTT non supporta i messaggi QoS di livello 2.</span><span class="sxs-lookup"><span data-stu-id="95fbf-125">This implementation of MQTT client does not support QoS level 2 messages.</span></span>

<span data-ttu-id="95fbf-126">Poiché QoS 1 e QoS 2 sono garantiti per essere recapitati, il Broker tiene traccia dello stato dei messaggi QoS 1 e QoS 2 inviati a ogni client.</span><span class="sxs-lookup"><span data-stu-id="95fbf-126">Since QoS 1 and QoS 2 are guaranteed to be delivered, the broker keeps track the state of QoS 1 and QoS 2 messages sent to each client.</span></span> <span data-ttu-id="95fbf-127">Questa operazione è particolarmente importante per i client che prevedono messaggi QoS1 o QoS 2.</span><span class="sxs-lookup"><span data-stu-id="95fbf-127">This is particularly important for clients that expect QoS1 or QoS 2 messages.</span></span> <span data-ttu-id="95fbf-128">Il client può essere disconnesso dal broker, ad esempio quando il client viene riavviato o il collegamento di comunicazione è temporaneamente perduto.</span><span class="sxs-lookup"><span data-stu-id="95fbf-128">The client may be disconnected from the broker (for example when the client reboots, or the communication link is temporarily lost).</span></span> <span data-ttu-id="95fbf-129">Il broker deve archiviare i messaggi QoS 1 e QoS 2 in modo che i messaggi possano essere recapitati in un secondo momento dopo che il client è stato riconnesso al broker.</span><span class="sxs-lookup"><span data-stu-id="95fbf-129">The broker must store QoS 1 and QoS 2 messages so the messages can be delivered later once the client is reconnected to the broker.</span></span> <span data-ttu-id="95fbf-130">Tuttavia, il client può scegliere di non ricevere messaggi non aggiornati dal broker dopo la riconnessione.</span><span class="sxs-lookup"><span data-stu-id="95fbf-130">However, the client may choose not to receive any stale messages from the broker after reconnection.</span></span> <span data-ttu-id="95fbf-131">Il client può eseguire questa operazione avviando la connessione con il flag di *clean_session* impostato su \***NX_TRUE** _.</span><span class="sxs-lookup"><span data-stu-id="95fbf-131">The client can do so by initiating the connection with the *clean_session* flag set to \***NX_TRUE** _.</span></span> <span data-ttu-id="95fbf-132">In questo caso, al momento della ricezione del messaggio MQTT CONNECT, il broker deve rimuovere tutte le informazioni di sessione associate a questo client, inclusi i messaggi QoS 1 o QoS 2 non recapitati o non confermati.</span><span class="sxs-lookup"><span data-stu-id="95fbf-132">In this case, upon receiving the MQTT CONNECT message, the broker shall discard any session information associated with this client, including undelivered or unconfirmed QoS 1 or QoS 2 messages.</span></span> <span data-ttu-id="95fbf-133">Se il _flag clean_session \* è per \***NX_FALSE**_, il server dovrà inviare di nuovo i messaggi QoS 1 e QoS 2.</span><span class="sxs-lookup"><span data-stu-id="95fbf-133">If the _clean_session\* flag is to \***NX_FALSE**_, the server shall resend the QoS 1 and QoS 2 messages.</span></span> <span data-ttu-id="95fbf-134">Il client MQTT invia anche nuovamente eventuali messaggi non riconosciuti se _clean_session \* è impostato su \*\**NX_TRUE *.**</span><span class="sxs-lookup"><span data-stu-id="95fbf-134">The MQTT Client also resends any un-acknowledged messages if _clean_session\* is set to \***NX_TRUE\*.**</span></span> <span data-ttu-id="95fbf-135">Questo riconoscimento è diverso dall'ACK del livello TCP, sebbene ciò avvenga.</span><span class="sxs-lookup"><span data-stu-id="95fbf-135">This acknowledgment is different from the TCP layer ACK, although that happens as well.</span></span> <span data-ttu-id="95fbf-136">Il client MQTT Invia un riconoscimento al broker.</span><span class="sxs-lookup"><span data-stu-id="95fbf-136">The MQTT client sends an acknowledgment to the broker.</span></span>

<span data-ttu-id="95fbf-137">Un'applicazione crea un'istanza del client MQTT chiamando \***nxd_mqtt_client_create ()** _.</span><span class="sxs-lookup"><span data-stu-id="95fbf-137">An application creates an MQTT client instance by calling \***nxd_mqtt_client_create()** _.</span></span> <span data-ttu-id="95fbf-138">Una volta creato il client, l'applicazione può connettersi al broker chiamando _*_nxd_mqtt_client_connect ()_*_.</span><span class="sxs-lookup"><span data-stu-id="95fbf-138">Once the client is created, the application can connect to the broker by calling _*_nxd_mqtt_client_connect()_*_.</span></span> <span data-ttu-id="95fbf-139">Dopo la connessione al broker, il client può sottoscrivere un argomento chiamando _*_nxd_mqtt_client_subscribe ()_*_ o pubblicare un argomento chiamando _ *_nxd_mqtt_client_publish ()_* \*.</span><span class="sxs-lookup"><span data-stu-id="95fbf-139">After connecting to the broker, the client can subscribe to a topic by calling _*_nxd_mqtt_client_subscribe()_*_, or publish a topic by calling _\*_nxd_mqtt_client_publish()_\*\*.</span></span>

<span data-ttu-id="95fbf-140">I messaggi MQTT in ingresso vengono archiviati nella coda di ricezione nell'istanza del client MQTT.</span><span class="sxs-lookup"><span data-stu-id="95fbf-140">Incoming MQTT messages are stored in the receive queue in the MQTT client instance.</span></span> <span data-ttu-id="95fbf-141">L'applicazione recupera questi messaggi chiamando ***nxd_mqtt_client_message_get ()***.</span><span class="sxs-lookup"><span data-stu-id="95fbf-141">Application retrieves these message by calling ***nxd_mqtt_client_message_get()***.</span></span> <span data-ttu-id="95fbf-142">Se sono presenti messaggi nella coda di ricezione, al chiamante viene restituito il primo messaggio, ad esempio il meno recente, dalla coda.</span><span class="sxs-lookup"><span data-stu-id="95fbf-142">If there are messages in the receive queue, the first message (e.g. the oldest) from the queue is returned to the caller.</span></span> <span data-ttu-id="95fbf-143">Viene restituita anche la stringa dell'argomento del messaggio.</span><span class="sxs-lookup"><span data-stu-id="95fbf-143">The topic string from the message is also returned.</span></span>

> [!NOTE]
> <span data-ttu-id="95fbf-144">La funzione \***nxd_mqtt_client_message_get ()** _ non viene bloccata se la coda di ricezione del client MQTT è vuota.</span><span class="sxs-lookup"><span data-stu-id="95fbf-144">The function \***nxd_mqtt_client_message_get()** _ does not block if the MQTT client receive queue is empty.</span></span> <span data-ttu-id="95fbf-145">La funzione restituisce immediatamente il codice restituito _ *_NXD_MQTT_NO_MESSAGE_* \*.</span><span class="sxs-lookup"><span data-stu-id="95fbf-145">The function returns immediately with the return code _\*_NXD_MQTT_NO_MESSAGE_\*\*.</span></span> <span data-ttu-id="95fbf-146">L'applicazione deve considerare questo valore restituito come indicazione che la coda di ricezione è vuota, non un errore.</span><span class="sxs-lookup"><span data-stu-id="95fbf-146">The application shall treat this return value as an indication that the receive queue is empty, not an error.</span></span>

<span data-ttu-id="95fbf-147">Per evitare il polling della coda di ricezione per i messaggi in arrivo, l'applicazione può registrare una funzione di callback con il client MQTT chiamando ***nxd_mqtt_client_recieve_notify_set ()***.</span><span class="sxs-lookup"><span data-stu-id="95fbf-147">To avoid polling the receive queue for incoming messages, the application can register a callback function with the MQTT client by calling ***nxd_mqtt_client_recieve_notify_set()***.</span></span> <span data-ttu-id="95fbf-148">La funzione di callback viene dichiarata come:</span><span class="sxs-lookup"><span data-stu-id="95fbf-148">The callback function is declared as:</span></span>

```c
VOID (*receive_notify_callback)(NXD_MQTT_CLIENT *client_ptr, 
    UINT message_count);
```

<span data-ttu-id="95fbf-149">Quando il client MQTT riceve messaggi dal broker, richiama la funzione di callback se la funzione è impostata.</span><span class="sxs-lookup"><span data-stu-id="95fbf-149">As the MQTT client receives messages from the broker, it invokes the callback function if the function is set.</span></span> <span data-ttu-id="95fbf-150">La funzione di callback passa il puntatore al blocco di controllo client e a un valore di conteggio messaggi.</span><span class="sxs-lookup"><span data-stu-id="95fbf-150">The callback function passes the pointer to the client control block and a message count value.</span></span> <span data-ttu-id="95fbf-151">Il valore di conteggio messaggi indica il numero di messaggi MQTT nella coda di ricezione.</span><span class="sxs-lookup"><span data-stu-id="95fbf-151">The message count value indicates the number of MQTT messages in the receive queue.</span></span> <span data-ttu-id="95fbf-152">Si noti che questa funzione di callback viene eseguita nel contesto del thread del client MQTT.</span><span class="sxs-lookup"><span data-stu-id="95fbf-152">Note that this callback function executes in the MQTT client thread context.</span></span> <span data-ttu-id="95fbf-153">Pertanto, la funzione di callback non deve eseguire alcuna routine che possa bloccare il thread del client MQTT.</span><span class="sxs-lookup"><span data-stu-id="95fbf-153">Therefore, the callback function should not execute any procedures that may block the MQTT client thread.</span></span> <span data-ttu-id="95fbf-154">La funzione di callback deve attivare il thread dell'applicazione per chiamare ***nxd_mqtt_client_message_get ()*** per recuperare i messaggi.</span><span class="sxs-lookup"><span data-stu-id="95fbf-154">The callback function should trigger the application thread to call ***nxd_mqtt_client_message_get()*** to retrieve the messages.</span></span>

<span data-ttu-id="95fbf-155">Per disconnettere e terminare il servizio client MQTT, l'applicazione deve usare il servizio ***nxd_mqtt_client_disconnect ()** _ e _*_nxd_mqtt_client_delete ()._\*_</span><span class="sxs-lookup"><span data-stu-id="95fbf-155">To disconnect and terminate the MQTT client service, the application shall use the service ***nxd_mqtt_client_disconnect()** _ and _*_nxd_mqtt_client_delete()._\*_</span></span> <span data-ttu-id="95fbf-156">La chiamata di _*_nxd_mqtt_client_disconnect ()_*_ disconnette semplicemente la connessione TCP al broker.</span><span class="sxs-lookup"><span data-stu-id="95fbf-156">Calling _*_nxd_mqtt_client_disconnect()_*_ simply disconnects the TCP connection to the broker.</span></span> <span data-ttu-id="95fbf-157">Rilascia i messaggi già ricevuti e archiviati nella coda di ricezione.</span><span class="sxs-lookup"><span data-stu-id="95fbf-157">It releases messages already received and stored in the receive queue.</span></span> <span data-ttu-id="95fbf-158">Tuttavia, non rilascia i messaggi QoS di livello 1 nella coda di trasmissione.</span><span class="sxs-lookup"><span data-stu-id="95fbf-158">However, it does not release QoS level 1 messages in the transmit queue.</span></span> <span data-ttu-id="95fbf-159">I messaggi QoS di livello 1 vengono ritrasmessi alla connessione, supponendo che il flag di _*_clean_session_*_ sia impostato su _ *_NX_FALSE._*\*</span><span class="sxs-lookup"><span data-stu-id="95fbf-159">QoS level 1 messages are retransmitted upon connection, assuming the _*_clean_session_*_ flag is set to _ *_NX_FALSE._*\*</span></span>

<span data-ttu-id="95fbf-160">Il broker può inoltre disconnettersi dal client.</span><span class="sxs-lookup"><span data-stu-id="95fbf-160">The broker may also disconnect from the client.</span></span> <span data-ttu-id="95fbf-161">Quando la connessione TCP tra il client e il Broker viene terminata, l'applicazione può ricevere una notifica tramite la funzione Disconnetti notifica.</span><span class="sxs-lookup"><span data-stu-id="95fbf-161">When the TCP connection between the client and the broker is terminated, the application can be notified by the disconnect notify function.</span></span> <span data-ttu-id="95fbf-162">Per usare il meccanismo di notifica, l'applicazione installa la funzione Disconnect Notify chiamando \*\**nxd_mqtt_client_disconnect_notify_set *.**</span><span class="sxs-lookup"><span data-stu-id="95fbf-162">To use the notification mechanism, application installs the disconnect notify function by calling \***nxd_mqtt_client_disconnect_notify_set\*.**</span></span> <span data-ttu-id="95fbf-163">Una volta osservata una disconnessione TCP e la sessione MQTT è stata creata, viene richiamata la funzione di notifica.</span><span class="sxs-lookup"><span data-stu-id="95fbf-163">Once a TCP disconnect is observed and the MQTT session has been created, the notification function is invoked.</span></span>

<span data-ttu-id="95fbf-164">La chiamata di ***nxd_mqtt_client_delete ()*** rilascia tutti i blocchi di messaggi nella coda di trasmissione e nella coda di ricezione.</span><span class="sxs-lookup"><span data-stu-id="95fbf-164">Calling ***nxd_mqtt_client_delete()*** releases all message blocks in the transmit queue and the receive queue.</span></span> <span data-ttu-id="95fbf-165">Vengono eliminati anche i messaggi di livello 1 di QoS non riconosciuti.</span><span class="sxs-lookup"><span data-stu-id="95fbf-165">Unacknowledged QoS level 1 messages are also deleted.</span></span>

## <a name="secure-mqtt-connection"></a><span data-ttu-id="95fbf-166">Connessione MQTT protetta</span><span class="sxs-lookup"><span data-stu-id="95fbf-166">Secure MQTT Connection</span></span>

<span data-ttu-id="95fbf-167">Il client MQTT esegue una connessione sicura al broker usando il modulo TLS sicuro NetX.</span><span class="sxs-lookup"><span data-stu-id="95fbf-167">The MQTT client makes a secure connection to the broker using the NetX Secure TLS module.</span></span> <span data-ttu-id="95fbf-168">Il numero di porta predefinito per MQTT con sicurezza TLS è 8883, definito in ***NXD_MQTT_TLS_PORT***.</span><span class="sxs-lookup"><span data-stu-id="95fbf-168">The default port number for MQTT with TLS security is 8883, defined in ***NXD_MQTT_TLS_PORT***.</span></span>

<span data-ttu-id="95fbf-169">Per creare una connessione MQTT sicura al broker, è necessario negoziare una sessione TLS dopo che è stata stabilita una connessione TCP, prima che i messaggi di MQTT CONNECT possano essere inviati al broker.</span><span class="sxs-lookup"><span data-stu-id="95fbf-169">To create a secure MQTT connection to the broker, a TLS session needs to be negotiated after a TCP connection is established, before MQTT CONNECT messages can be sent to the broker.</span></span> <span data-ttu-id="95fbf-170">La configurazione della sessione TLS viene eseguita chiamando ***nxd_mqtt_client_secure_connect ()*** e passando una funzione di callback del programma di installazione TLS definita dall'utente.</span><span class="sxs-lookup"><span data-stu-id="95fbf-170">The TLS session set up is accomplished by calling ***nxd_mqtt_client_secure_connect()*** and passing in a user-defined TLS setup callback function.</span></span> <span data-ttu-id="95fbf-171">Durante la fase di connessione MQTT, una volta stabilita la connessione TCP, il client richiama la funzione di callback dell'installazione TLS per avviare un processo di handshake TLS appropriato.</span><span class="sxs-lookup"><span data-stu-id="95fbf-171">During the MQTT connection phase, once the TCP connection is established, the client invokes the TLS setup callback function to start a proper TLS handshake process.</span></span> <span data-ttu-id="95fbf-172">Una volta stabilita la sessione TLS, il client continua il messaggio MQTT CONNECT sul canale sicuro.</span><span class="sxs-lookup"><span data-stu-id="95fbf-172">After the TLS session is established, the client continues the MQTT CONNECT message over the secure channel.</span></span>

<span data-ttu-id="95fbf-173">La funzione di callback definita dall'utente accetta cinque valori di input e viene dichiarata come:</span><span class="sxs-lookup"><span data-stu-id="95fbf-173">The user defined callback function takes five input values and is declared as:</span></span>

```c
UINT tls_Setup_callback(NXD_MQTT_CLIENT *client_ptr,
    NX_SECURE_TLS_SESSION *session_ptr,
    NX_SECURE_TLS_CERTIFICATE *certificate_ptr,
    NX_SECURE_TLS_CERTIFICATE *trusted_cerfiticate);
```

<span data-ttu-id="95fbf-174">Di seguito è riportata una descrizione dei parametri di input:</span><span class="sxs-lookup"><span data-stu-id="95fbf-174">Below is a description of the input parameters:</span></span>

- <span data-ttu-id="95fbf-175">**client_ptr**: puntatore al blocco di controllo client MQTT.</span><span class="sxs-lookup"><span data-stu-id="95fbf-175">**client_ptr**: Pointer to the MQTT client control block.</span></span>
- <span data-ttu-id="95fbf-176">**session_ptr**: puntatore al blocco di controllo della sessione TLS.</span><span class="sxs-lookup"><span data-stu-id="95fbf-176">**session_ptr**: Pointer to the TLS session control block.</span></span>
- <span data-ttu-id="95fbf-177">**certificate_ptr**: puntatore al blocco di controllo del certificato.</span><span class="sxs-lookup"><span data-stu-id="95fbf-177">**certificate_ptr**: Pointer to the certificate control block.</span></span> <span data-ttu-id="95fbf-178">La funzione di installazione configura questo certificato prima di inviarlo al broker.</span><span class="sxs-lookup"><span data-stu-id="95fbf-178">The setup function configures this certificate before sending it to the broker.</span></span>
- <span data-ttu-id="95fbf-179">**trusted_certificate_ptr**: puntatore al certificato attendibile.</span><span class="sxs-lookup"><span data-stu-id="95fbf-179">**trusted_certificate_ptr**: Pointer to the trusted certificate.</span></span> <span data-ttu-id="95fbf-180">La funzione di installazione TLS configura il certificato attendibile per autenticare il server.</span><span class="sxs-lookup"><span data-stu-id="95fbf-180">TLS setup function configures the trusted certificate to authenticate the server.</span></span>

<span data-ttu-id="95fbf-181">Nella funzione di installazione di TLS, l'applicazione è responsabile della creazione di una sessione TLS e della configurazione della sessione con un certificato appropriato.</span><span class="sxs-lookup"><span data-stu-id="95fbf-181">In the TLS setup function, the application is responsible for creating a TLS session, and configuring the session with a proper certificate.</span></span> <span data-ttu-id="95fbf-182">Nello pseudo codice seguente viene illustrata una tipica procedura di avvio della sessione TLS.</span><span class="sxs-lookup"><span data-stu-id="95fbf-182">The following pseudo code outlines a typical TLS session start up procedure.</span></span> <span data-ttu-id="95fbf-183">Per informazioni dettagliate sull'uso delle API TLS, il lettore fa riferimento alla guida dell'utente di NetX Secure TLS.</span><span class="sxs-lookup"><span data-stu-id="95fbf-183">The reader is referred to the NetX Secure TLS User Guide for details on using TLS APIs.</span></span>

<span data-ttu-id="95fbf-184">Di seguito è riportato un esempio di callback di installazione TLS:</span><span class="sxs-lookup"><span data-stu-id="95fbf-184">Below is an example TLS setup callback:</span></span>

```c
UINT tls_setup_callback(NXD_MQTT_CLIENT *client_pt
    NX_SECURE_TLS_SESSION *session_ptr,
    NX_SECURE_TLS_CERTIFICATE *certrifcate_ptr,
    NX_SECURE_TLS_CERTIFICATE *trusted_certificate_ptr)
{
    /* Initialize TLS module */
    nx_secure_tls_initialize();

    /* Create a TLS session */
    nx_secure_tls_session_create(session_ptr, …);

    /* Need to allocate space for the certificate coming in from the broker. */
    memset(certificate_ptr), 0, sizeof(NX_SECURE_TLS_CERTIFICATE));

    nx_secure_tls_remote_certificate_allocate(session_ptr, certificate_ptr);

    /* Add a CA Certificate to our trusted store for verifying incomingserver certificates. */
    nx_secure_tls_certificate_initialize(
        trusted_certificate_ptr,
        ca_cert_der,
        ca_cert_der_len, NULL, 0);
    nx_secure_tls_trusted_certificate_add(session_ptr,
        trusted_certificate));
}
```

## <a name="known-limitations-of-the-netx-duo-mqtt-client"></a><span data-ttu-id="95fbf-185">Limitazioni note del client NetX Duo MQTT</span><span class="sxs-lookup"><span data-stu-id="95fbf-185">Known Limitations of the NetX Duo MQTT Client</span></span>

- <span data-ttu-id="95fbf-186">NetX Duo MQTT non supporta l'invio o la ricezione di messaggi QoS di livello 2.</span><span class="sxs-lookup"><span data-stu-id="95fbf-186">NetX Duo MQTT does not support sending or receiving QoS level 2 messages.</span></span>
- <span data-ttu-id="95fbf-187">NetX Duo MQTT non supporta i pacchetti concatenati.</span><span class="sxs-lookup"><span data-stu-id="95fbf-187">NetX Duo MQTT does not support chained-packets.</span></span>
