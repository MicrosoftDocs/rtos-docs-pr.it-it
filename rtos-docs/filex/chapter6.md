---
title: Capitolo 6-modulo a tolleranza di errore FileX di Azure RTO
description: Questo capitolo contiene una descrizione del modulo a tolleranza d'errore FileX di Azure RTO progettato per mantenere file system integrità se il supporto perde energia o viene espulso durante un'operazione di scrittura di file.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 68a24f0345a2c4d3e824270699b00a2daab32f8e
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/22/2021
ms.locfileid: "104822409"
---
# <a name="chapter-6---azure-rtos-filex-fault-tolerant-module"></a><span data-ttu-id="08ed6-103">Capitolo 6-modulo a tolleranza di errore FileX di Azure RTO</span><span class="sxs-lookup"><span data-stu-id="08ed6-103">Chapter 6 - Azure RTOS FileX fault tolerant module</span></span>

<span data-ttu-id="08ed6-104">Questo capitolo contiene una descrizione del modulo a tolleranza d'errore FileX di Azure RTO progettato per mantenere file system integrità se il supporto perde energia o viene espulso durante un'operazione di scrittura di file.</span><span class="sxs-lookup"><span data-stu-id="08ed6-104">This chapter contains a description of the Azure RTOS FileX Fault Tolerant Module that is designed to maintain file system integrity if the media loses power or is ejected in the middle of a file write operation.</span></span>

## <a name="filex-fault-tolerant-module-overview"></a><span data-ttu-id="08ed6-105">Panoramica del modulo a tolleranza di errore FileX</span><span class="sxs-lookup"><span data-stu-id="08ed6-105">FileX Fault Tolerant Module Overview</span></span>

<span data-ttu-id="08ed6-106">Quando un'applicazione scrive i dati in un file, FileX aggiorna sia i cluster di dati che le informazioni di sistema.</span><span class="sxs-lookup"><span data-stu-id="08ed6-106">When an application writes data into a file, FileX updates both data clusters and system information.</span></span> <span data-ttu-id="08ed6-107">Questi aggiornamenti devono essere completati come operazione atomica per tenere coerenti le informazioni nel file system.</span><span class="sxs-lookup"><span data-stu-id="08ed6-107">These updates must be completed as an atomic operation to keep information in the file system coherent.</span></span> <span data-ttu-id="08ed6-108">Ad esempio, quando si accodano i dati a un file, FileX deve trovare un cluster disponibile nel supporto, aggiornare la catena FAT, aggiornare la lunghezza registrata nella voce della directory ed eventualmente aggiornare il numero del cluster iniziale nella voce di directory.</span><span class="sxs-lookup"><span data-stu-id="08ed6-108">For example, when appending data to a file, FileX needs to find an available cluster in the media, update the FAT chain, update the length filed in the directory entry, and possibly update the starting cluster number in the directory entry.</span></span> <span data-ttu-id="08ed6-109">L'interruzione dell'alimentazione o dell'espulsione dei supporti può interrompere la sequenza di aggiornamenti, che lascerà il file system in uno stato incoerente.</span><span class="sxs-lookup"><span data-stu-id="08ed6-109">Either a power failure or media ejection can interrupt the sequence of updates, which will leave the file system in an inconsistent state.</span></span> <span data-ttu-id="08ed6-110">Se lo stato non è coerente, i dati aggiornati possono andare perduti e, a causa di danni alle informazioni di sistema, l'operazione di file system successiva potrebbe danneggiare altri file o directory sul supporto.</span><span class="sxs-lookup"><span data-stu-id="08ed6-110">If the inconsistent state is not corrected, the data being updated can be lost, and because of damage to the system information, subsequent file system operation may damage other files or directories on the media.</span></span>

<span data-ttu-id="08ed6-111">Il modulo a tolleranza di errore FileX funziona eseguendo i passaggi di inserimento nel journal necessari per aggiornare un file *prima* di applicare questi passaggi al file System.</span><span class="sxs-lookup"><span data-stu-id="08ed6-111">The FileX Fault Tolerant Module works by journaling steps required to update a file *before* these steps are applied to the file system.</span></span> <span data-ttu-id="08ed6-112">Se l'aggiornamento del file ha esito positivo, queste voci di log vengono rimosse.</span><span class="sxs-lookup"><span data-stu-id="08ed6-112">If the file update is successful, these log entries are removed.</span></span> <span data-ttu-id="08ed6-113">Tuttavia, se l'aggiornamento del file viene interrotto, le voci di log vengono archiviate nel supporto.</span><span class="sxs-lookup"><span data-stu-id="08ed6-113">However, if the file update is interrupted, the log entries are stored on the media.</span></span> <span data-ttu-id="08ed6-114">Alla successiva installazione del supporto, FileX rileva queste voci di log dall'operazione di scrittura precedente (non completata).</span><span class="sxs-lookup"><span data-stu-id="08ed6-114">Next time the media is mounted, FileX detects these log entries from the previous (unfinished) write operation.</span></span> <span data-ttu-id="08ed6-115">In questi casi, FileX può eseguire il ripristino da un errore eseguendo il rollback delle modifiche già apportate al file system o riapplicando le modifiche necessarie per completare l'operazione precedente.</span><span class="sxs-lookup"><span data-stu-id="08ed6-115">In such cases, FileX can recover from a failure by either rolling back the changes already made to the file system, or by reapplying the required changes to complete the previous operation.</span></span> <span data-ttu-id="08ed6-116">In questo modo, il modulo a tolleranza di errore FileX mantiene l'integrità file system se il supporto perde energia durante un'operazione di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="08ed6-116">In this way, the FileX Fault Tolerant Module maintains file system integrity if the media loses power during an update operation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="08ed6-117">*Il modulo a tolleranza di errore FileX non è progettato per evitare file system danneggiamenti causati da un danneggiamento dei supporti fisici con dati validi.*</span><span class="sxs-lookup"><span data-stu-id="08ed6-117">*The FileX Fault Tolerant Module is not designed to prevent file system corruption caused by physical media corruption with valid data in it.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="08ed6-118">*Quando il modulo a tolleranza di errore FileX protegge un supporto, il supporto non deve essere montato da un valore diverso da FileX con tolleranza di errore abilitata. In questo modo le voci di log del file system non saranno coerenti con le informazioni di sistema sui supporti. Se il modulo a tolleranza di errore FileX tenta di elaborare le voci di log dopo che il supporto è stato aggiornato da un altro file system, la procedura di ripristino potrebbe non riuscire, lasciando l'intero file system in uno stato imprevedibile.*</span><span class="sxs-lookup"><span data-stu-id="08ed6-118">*After the FileX Fault Tolerant module protects a media, the media must not be mounted by anything other than FileX with Fault Tolerant enabled. Doing so can cause the log entries in the file system to be inconsistent with system information on the media. If the FileX Fault Tolerant module attempts to process log entries after the media is updated by another file system, the recovery procedure may fail, leaving the entire file system in an unpredictable state.*</span></span>

## <a name="use-of-the-fault-tolerant-module"></a><span data-ttu-id="08ed6-119">Uso del modulo a tolleranza di errore</span><span class="sxs-lookup"><span data-stu-id="08ed6-119">Use of the Fault Tolerant Module</span></span>

<span data-ttu-id="08ed6-120">La funzionalità di tolleranza di errore FileX è disponibile per tutti i file system FAT supportati da FileX, tra cui FAT12, FAT16, FAT32 e exFAT.</span><span class="sxs-lookup"><span data-stu-id="08ed6-120">The FileX Fault Tolerant feature is available to all FAT file systems supported by FileX, including FAT12, FAT16, FAT32, and exFAT.</span></span> <span data-ttu-id="08ed6-121">Per abilitare la funzionalità di tolleranza di errore, è necessario compilare FileX con il simbolo **FX_ENABLE_FAULT_TOLERANT** definito.</span><span class="sxs-lookup"><span data-stu-id="08ed6-121">To enable the fault tolerant feature, FileX must be built with the symbol **FX_ENABLE_FAULT_TOLERANT** defined.</span></span> <span data-ttu-id="08ed6-122">In fase di esecuzione, l'applicazione avvia il servizio a tolleranza di errore chiamando **_fx_fault_tolerant_enable_*_ immediatamente dopo la chiamata a _*_fx_media_open_**.</span><span class="sxs-lookup"><span data-stu-id="08ed6-122">At run time, application starts fault tolerant service by calling **_fx_fault_tolerant_enable_*_ immediately after the call to _*_fx_media_open_**.</span></span> <span data-ttu-id="08ed6-123">Una volta abilitata la tolleranza di errore, tutte le operazioni di scrittura di file nel supporto designato sono protette.</span><span class="sxs-lookup"><span data-stu-id="08ed6-123">After fault tolerant is enabled, all file write operations to the designated media are protected.</span></span> <span data-ttu-id="08ed6-124">Per impostazione predefinita, il modulo a tolleranza di errore non è abilitato.</span><span class="sxs-lookup"><span data-stu-id="08ed6-124">By default the fault tolerant module is not enabled.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="08ed6-125">\* L'applicazione deve assicurarsi che non sia stato eseguito l'accesso file system prima di \***fx_fault_tolerant_enable** _ chiamata.</span><span class="sxs-lookup"><span data-stu-id="08ed6-125">\*Application needs to make sure the file system is not being accessed prior to \***fx_fault_tolerant_enable** _ being called.</span></span> <span data-ttu-id="08ed6-126">Se l'applicazione scrive i dati nel file system prima dell'abilitazione a tolleranza di errore, è possibile che l'operazione di scrittura danneggi i supporti se le operazioni di scrittura precedenti non sono state completate e il file system non è stato ripristinato utilizzando il entries._ registro a tolleranza di errore</span><span class="sxs-lookup"><span data-stu-id="08ed6-126">If application writes data to the file system prior to fault tolerant enable, the write operation could corrupt the media if prior write operations were not completed, and the file system was not restored using fault tolerant log entries._</span></span>

## <a name="filex-fault-tolerant-module-log"></a><span data-ttu-id="08ed6-127">Registro modulo a tolleranza di errore FileX</span><span class="sxs-lookup"><span data-stu-id="08ed6-127">FileX Fault Tolerant Module Log</span></span>

<span data-ttu-id="08ed6-128">Il log a tolleranza di errore FileX occupa un cluster logico in Flash.</span><span class="sxs-lookup"><span data-stu-id="08ed6-128">The FileX fault tolerant log takes up one logical cluster in flash.</span></span> <span data-ttu-id="08ed6-129">L'indice per il numero del cluster iniziale del cluster viene registrato nel settore di avvio del supporto, con un offset specificato dal simbolo **FX_FAULT_TOLERANT_BOOT_INDEX**.</span><span class="sxs-lookup"><span data-stu-id="08ed6-129">The index to the starting cluster number of that cluster is recorded in the boot sector of the media, with an offset specified by the symbol **FX_FAULT_TOLERANT_BOOT_INDEX**.</span></span> <span data-ttu-id="08ed6-130">Per impostazione predefinita, questo simbolo è definito come 116.</span><span class="sxs-lookup"><span data-stu-id="08ed6-130">By default this symbol is defined to be 116.</span></span> <span data-ttu-id="08ed6-131">Questo percorso viene scelto perché è contrassegnato come riservato in FAT12/16/32 e exFAT Specification.</span><span class="sxs-lookup"><span data-stu-id="08ed6-131">This location is chosen because it is marked as reserved in FAT12/ 16/32 and exFAT specification.</span></span>

<span data-ttu-id="08ed6-132">Nella figura 5 viene illustrato il layout generale della struttura dei log.</span><span class="sxs-lookup"><span data-stu-id="08ed6-132">Figure 5, "Log Structure Layout," shows the general layout of the log structure.</span></span> <span data-ttu-id="08ed6-133">La struttura di log contiene tre sezioni: intestazione del log, catena FAT e voci di log.</span><span class="sxs-lookup"><span data-stu-id="08ed6-133">The log structure contains three sections: Log Header, FAT Chain, and Log Entries.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="08ed6-134">*Tutti i valori multibyte archiviati nelle voci di log sono in formato little endian.*</span><span class="sxs-lookup"><span data-stu-id="08ed6-134">*All multi-byte values stored in the log entries are in Little Endian format.*</span></span>

![Layout struttura log](./media/user-guide/log-structure-layout.png)

<span data-ttu-id="08ed6-136">**Figura 5. Layout struttura log**</span><span class="sxs-lookup"><span data-stu-id="08ed6-136">**Figure 5. Log Structure Layout**</span></span>

<span data-ttu-id="08ed6-137">L'area di intestazione del log contiene informazioni che descrivono l'intera struttura di log e illustrano ogni campo in dettaglio.</span><span class="sxs-lookup"><span data-stu-id="08ed6-137">The Log Header area contains information that describes the entire log structure and explains each field in detail.</span></span>

<span data-ttu-id="08ed6-138">**TABELLA 8. Area di intestazione del log**</span><span class="sxs-lookup"><span data-stu-id="08ed6-138">**TABLE 8. Log Header Area**</span></span>

|<span data-ttu-id="08ed6-139">Campo</span><span class="sxs-lookup"><span data-stu-id="08ed6-139">Field</span></span>|<span data-ttu-id="08ed6-140">Dimensioni (in byte)</span><span class="sxs-lookup"><span data-stu-id="08ed6-140">Size(in bytes)</span></span>|<span data-ttu-id="08ed6-141">Descrizione</span><span class="sxs-lookup"><span data-stu-id="08ed6-141">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="08ed6-142">ID</span><span class="sxs-lookup"><span data-stu-id="08ed6-142">ID</span></span>|<span data-ttu-id="08ed6-143">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-143">4</span></span>|<span data-ttu-id="08ed6-144">Identifica una struttura di log a tolleranza di errore FileX.</span><span class="sxs-lookup"><span data-stu-id="08ed6-144">Identifies a FileX Fault Tolerant Log structure.</span></span> <span data-ttu-id="08ed6-145">La struttura di log viene considerata non valida se il valore ID non è 0x46544C52.</span><span class="sxs-lookup"><span data-stu-id="08ed6-145">The log structure is considered invalid if the ID value is not 0x46544C52.</span></span>|
|<span data-ttu-id="08ed6-146">Dimensione totale</span><span class="sxs-lookup"><span data-stu-id="08ed6-146">Total Size</span></span>|<span data-ttu-id="08ed6-147">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-147">2</span></span>|<span data-ttu-id="08ed6-148">Indica la dimensione totale (in byte) dell'intera struttura di log.</span><span class="sxs-lookup"><span data-stu-id="08ed6-148">Indicates the total size (in bytes) of the entire log structure.</span></span>|
|<span data-ttu-id="08ed6-149">Checksum dell'intestazione</span><span class="sxs-lookup"><span data-stu-id="08ed6-149">Header Checksum</span></span>|<span data-ttu-id="08ed6-150">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-150">2</span></span>|<span data-ttu-id="08ed6-151">Checksum che converte l'area dell'intestazione del log.</span><span class="sxs-lookup"><span data-stu-id="08ed6-151">Checksum that converts the log header area.</span></span> <span data-ttu-id="08ed6-152">La struttura di log viene considerata non valida se i campi di intestazione non superano la verifica del checksum.</span><span class="sxs-lookup"><span data-stu-id="08ed6-152">The log structure is considered invalid if the header fields fail the checksum verification.</span></span>|
|<span data-ttu-id="08ed6-153">Numero di versione</span><span class="sxs-lookup"><span data-stu-id="08ed6-153">Version Number</span></span>|<span data-ttu-id="08ed6-154">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-154">2</span></span>|<span data-ttu-id="08ed6-155">Numeri di versione principale e secondaria a tolleranza di errore FileX.</span><span class="sxs-lookup"><span data-stu-id="08ed6-155">FileX Fault Tolerant major and minor version numbers.</span></span>|
|<span data-ttu-id="08ed6-156">Riservato</span><span class="sxs-lookup"><span data-stu-id="08ed6-156">Reserved</span></span>|<span data-ttu-id="08ed6-157">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-157">2</span></span>|<span data-ttu-id="08ed6-158">Per l'espansione futura.</span><span class="sxs-lookup"><span data-stu-id="08ed6-158">For future expansion.</span></span>|

<span data-ttu-id="08ed6-159">L'area di intestazione del log è seguita dall'area log della catena FAT.</span><span class="sxs-lookup"><span data-stu-id="08ed6-159">The Log Header area is followed by the FAT Chain Log area.</span></span> <span data-ttu-id="08ed6-160">La figura 9 contiene informazioni che descrivono la modalità di modifica della catena FAT.</span><span class="sxs-lookup"><span data-stu-id="08ed6-160">Figure 9 contains information that describes how the FAT chain should be modified.</span></span> <span data-ttu-id="08ed6-161">Questa area di log contiene informazioni sui cluster allocati a un file, i cluster rimossi da un file e il punto in cui l'inserimento/eliminazione deve essere e descrive ogni campo nell'area log della catena FAT.</span><span class="sxs-lookup"><span data-stu-id="08ed6-161">This log area contains information on the clusters being allocated to a file, the clusters being removed from a file, and where the insertion/deletion should be and describes each field in the FAT Chain Log area.</span></span>

<span data-ttu-id="08ed6-162">**TABELLA 9. Area log della catena FAT**</span><span class="sxs-lookup"><span data-stu-id="08ed6-162">**TABLE 9. FAT Chain Log Area**</span></span>

|<span data-ttu-id="08ed6-163">Campo</span><span class="sxs-lookup"><span data-stu-id="08ed6-163">Field</span></span>|<span data-ttu-id="08ed6-164">Dimensioni (in byte)</span><span class="sxs-lookup"><span data-stu-id="08ed6-164">Size(in bytes)</span></span>|<span data-ttu-id="08ed6-165">Descrizione</span><span class="sxs-lookup"><span data-stu-id="08ed6-165">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="08ed6-166">Checksum log catena FAT</span><span class="sxs-lookup"><span data-stu-id="08ed6-166">FAT Chain Log Checksum</span></span>|<span data-ttu-id="08ed6-167">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-167">2</span></span>|<span data-ttu-id="08ed6-168">Checksum dell'intera area di log della catena FAT.</span><span class="sxs-lookup"><span data-stu-id="08ed6-168">Checksum of the entire FAT Chain Log area.</span></span> <span data-ttu-id="08ed6-169">L'area log della catena FAT viene considerata non valida se la verifica del checksum non riesce.</span><span class="sxs-lookup"><span data-stu-id="08ed6-169">The FAT Chain Log area is considered invalid if the it fails the checksum verification.</span></span>|
|<span data-ttu-id="08ed6-170">Contrassegno</span><span class="sxs-lookup"><span data-stu-id="08ed6-170">Flag</span></span>|<span data-ttu-id="08ed6-171">1</span><span class="sxs-lookup"><span data-stu-id="08ed6-171">1</span></span>|<span data-ttu-id="08ed6-172">I valori validi per i flag sono:</span><span class="sxs-lookup"><span data-stu-id="08ed6-172">Valid flag values are:</span></span><br/><span data-ttu-id="08ed6-173">0x01 catena FAT valida</span><span class="sxs-lookup"><span data-stu-id="08ed6-173">0x01 FAT Chain Valid</span></span><br /><span data-ttu-id="08ed6-174">0x02 BITMAP in uso</span><span class="sxs-lookup"><span data-stu-id="08ed6-174">0x02 BITMAP is being used</span></span>|
|<span data-ttu-id="08ed6-175">Riservato</span><span class="sxs-lookup"><span data-stu-id="08ed6-175">Reserved</span></span>|<span data-ttu-id="08ed6-176">1</span><span class="sxs-lookup"><span data-stu-id="08ed6-176">1</span></span>|<span data-ttu-id="08ed6-177">Riservate per utilizzo futuro</span><span class="sxs-lookup"><span data-stu-id="08ed6-177">Reserved for future use</span></span>|
|<span data-ttu-id="08ed6-178">Punto di inserimento-anteriore</span><span class="sxs-lookup"><span data-stu-id="08ed6-178">Insertion Point – Front</span></span>|<span data-ttu-id="08ed6-179">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-179">4</span></span>|<span data-ttu-id="08ed6-180">Il cluster, che appartiene alla catena FAT originale, in cui la catena appena creata verrà collegata a.</span><span class="sxs-lookup"><span data-stu-id="08ed6-180">The cluster (that belongs to the original FAT chain) where the newly created chain is going to be attached to.</span></span>|
|<span data-ttu-id="08ed6-181">Cluster Head di una nuova catena FAT</span><span class="sxs-lookup"><span data-stu-id="08ed6-181">Head Cluster of New FAT Chain</span></span>|<span data-ttu-id="08ed6-182">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-182">4</span></span>|<span data-ttu-id="08ed6-183">Primo cluster della catena FAT appena creata</span><span class="sxs-lookup"><span data-stu-id="08ed6-183">The first cluster of the newly created FAT Chain</span></span>|
|<span data-ttu-id="08ed6-184">Cluster Head della catena FAT originale</span><span class="sxs-lookup"><span data-stu-id="08ed6-184">Head Cluster of Original FAT Chain</span></span>|<span data-ttu-id="08ed6-185">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-185">4</span></span>|<span data-ttu-id="08ed6-186">Primo cluster della parte della catena FAT originale da rimuovere.</span><span class="sxs-lookup"><span data-stu-id="08ed6-186">The first cluster of the portion of the original FAT Chain that is to be removed.</span></span>|
|<span data-ttu-id="08ed6-187">Punto di inserimento-indietro</span><span class="sxs-lookup"><span data-stu-id="08ed6-187">Insertion Point – Back</span></span>|<span data-ttu-id="08ed6-188">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-188">4</span></span>|<span data-ttu-id="08ed6-189">Il cluster originale in cui si unisce la catena FAT appena creata in.</span><span class="sxs-lookup"><span data-stu-id="08ed6-189">The original cluster where the newly created FAT chain joins at.</span></span>|
|<span data-ttu-id="08ed6-190">Punto di eliminazione successivo</span><span class="sxs-lookup"><span data-stu-id="08ed6-190">Next Deletion Point</span></span>|<span data-ttu-id="08ed6-191">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-191">4</span></span>|<span data-ttu-id="08ed6-192">Questo campo supporta la procedura di pulizia della catena FAT.</span><span class="sxs-lookup"><span data-stu-id="08ed6-192">This field assists the FAT chain cleanup procedure.</span></span>|

<span data-ttu-id="08ed6-193">L'area voci di log contiene le voci di log che descrivono le modifiche necessarie per il ripristino da un errore.</span><span class="sxs-lookup"><span data-stu-id="08ed6-193">The Log Entries Area contains log entries that describe the changes needed to recover from a failure.</span></span> <span data-ttu-id="08ed6-194">Nel modulo a tolleranza di errore FileX sono supportati tre tipi di voce di log: voce di log FAT; Voce di log directory; e la voce di log bitmap.</span><span class="sxs-lookup"><span data-stu-id="08ed6-194">There are three types of log entry supported in the FileX fault tolerant module: FAT Log Entry; Directory Log Entry; and Bitmap Log Entry.</span></span>

<span data-ttu-id="08ed6-195">Le seguenti tre figure e tre tabelle descrivono in dettaglio queste voci di log.</span><span class="sxs-lookup"><span data-stu-id="08ed6-195">The following three figures and three tables describe these log entries in detail.</span></span>

![Voce di log FAT](./media/user-guide/fat-log-entry.png)

<span data-ttu-id="08ed6-197">**Figura 6. Voce di log FAT**</span><span class="sxs-lookup"><span data-stu-id="08ed6-197">**Figure 6. FAT Log Entry**</span></span>

<span data-ttu-id="08ed6-198">**TABELLA 10. Voce di log FAT**</span><span class="sxs-lookup"><span data-stu-id="08ed6-198">**TABLE 10. FAT Log Entry**</span></span>

|<span data-ttu-id="08ed6-199">Campo</span><span class="sxs-lookup"><span data-stu-id="08ed6-199">Field</span></span>|<span data-ttu-id="08ed6-200">Dimensioni (in byte)</span><span class="sxs-lookup"><span data-stu-id="08ed6-200">Size(in bytes)</span></span>|<span data-ttu-id="08ed6-201">Descrizione</span><span class="sxs-lookup"><span data-stu-id="08ed6-201">Description</span></span>|
|-----|--------------|-----------|
<span data-ttu-id="08ed6-202">Type</span><span class="sxs-lookup"><span data-stu-id="08ed6-202">Type</span></span>|<span data-ttu-id="08ed6-203">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-203">2</span></span>|<span data-ttu-id="08ed6-204">Tipo di voce, deve essere FX_FAULT_TOLERANT_FAT_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="08ed6-204">Type of Entry, must be FX_FAULT_TOLERANT_FAT_LOG_TYPE</span></span>|
|<span data-ttu-id="08ed6-205">Dimensione</span><span class="sxs-lookup"><span data-stu-id="08ed6-205">Size</span></span>|<span data-ttu-id="08ed6-206">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-206">2</span></span>|<span data-ttu-id="08ed6-207">Dimensioni di questa voce</span><span class="sxs-lookup"><span data-stu-id="08ed6-207">Size of this entry</span></span>|
|<span data-ttu-id="08ed6-208">Numero di cluster</span><span class="sxs-lookup"><span data-stu-id="08ed6-208">Cluster Number</span></span>|<span data-ttu-id="08ed6-209">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-209">4</span></span>|<span data-ttu-id="08ed6-210">Numero di cluster</span><span class="sxs-lookup"><span data-stu-id="08ed6-210">Cluster number</span></span>|
|<span data-ttu-id="08ed6-211">Valore</span><span class="sxs-lookup"><span data-stu-id="08ed6-211">Value</span></span>|<span data-ttu-id="08ed6-212">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-212">4</span></span>|<span data-ttu-id="08ed6-213">Valore da scrivere nella voce FAT</span><span class="sxs-lookup"><span data-stu-id="08ed6-213">Value to be written into the FAT entry</span></span>|

![Voce di log di directory](./media/user-guide/directory-log-entry.png)

<span data-ttu-id="08ed6-215">**Figura 7. Voce di log di directory**</span><span class="sxs-lookup"><span data-stu-id="08ed6-215">**Figure 7. Directory Log Entry**</span></span>

<span data-ttu-id="08ed6-216">**TABELLA 11. Voce di log di directory**</span><span class="sxs-lookup"><span data-stu-id="08ed6-216">**TABLE 11. Directory Log Entry**</span></span>

|<span data-ttu-id="08ed6-217">Campo</span><span class="sxs-lookup"><span data-stu-id="08ed6-217">Field</span></span>|<span data-ttu-id="08ed6-218">Dimensioni (in byte)</span><span class="sxs-lookup"><span data-stu-id="08ed6-218">Size(in bytes)</span></span>|<span data-ttu-id="08ed6-219">Descrizione</span><span class="sxs-lookup"><span data-stu-id="08ed6-219">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="08ed6-220">Type</span><span class="sxs-lookup"><span data-stu-id="08ed6-220">Type</span></span>|<span data-ttu-id="08ed6-221">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-221">2</span></span>|<span data-ttu-id="08ed6-222">Tipo di voce, deve essere FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="08ed6-222">Type of Entry, must be FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span></span>|
|<span data-ttu-id="08ed6-223">Dimensione</span><span class="sxs-lookup"><span data-stu-id="08ed6-223">Size</span></span>|<span data-ttu-id="08ed6-224">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-224">2</span></span>|<span data-ttu-id="08ed6-225">Dimensioni di questa voce</span><span class="sxs-lookup"><span data-stu-id="08ed6-225">Size of this entry</span></span>|
|<span data-ttu-id="08ed6-226">Offset settore</span><span class="sxs-lookup"><span data-stu-id="08ed6-226">Sector Offset</span></span>|<span data-ttu-id="08ed6-227">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-227">4</span></span>|<span data-ttu-id="08ed6-228">Offset (in byte) nel settore in cui si trova questa directory.</span><span class="sxs-lookup"><span data-stu-id="08ed6-228">Offset (in bytes) into the sector where this directory is located.</span></span>|
|<span data-ttu-id="08ed6-229">Settore di log</span><span class="sxs-lookup"><span data-stu-id="08ed6-229">Log Sector</span></span>|<span data-ttu-id="08ed6-230">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-230">4</span></span>|<span data-ttu-id="08ed6-231">Settore in cui si trova la voce della directory</span><span class="sxs-lookup"><span data-stu-id="08ed6-231">The sector where the directory entry is located</span></span>|
|<span data-ttu-id="08ed6-232">Dati del registro</span><span class="sxs-lookup"><span data-stu-id="08ed6-232">Log Data</span></span>|<span data-ttu-id="08ed6-233">Variabile</span><span class="sxs-lookup"><span data-stu-id="08ed6-233">Variable</span></span>|<span data-ttu-id="08ed6-234">Contenuto della voce di directory</span><span class="sxs-lookup"><span data-stu-id="08ed6-234">Content of the directory entry</span></span>|

![Voce di log bitmap](./media/user-guide/bitmap-log-entry.png)

<span data-ttu-id="08ed6-236">**Figura 8. Voce di log bitmap**</span><span class="sxs-lookup"><span data-stu-id="08ed6-236">**Figure 8. Bitmap Log Entry**</span></span>

<span data-ttu-id="08ed6-237">**TABELLA 12. Voce di log bitmap**</span><span class="sxs-lookup"><span data-stu-id="08ed6-237">**TABLE 12. Bitmap Log Entry**</span></span>

|<span data-ttu-id="08ed6-238">Campo</span><span class="sxs-lookup"><span data-stu-id="08ed6-238">Field</span></span>|<span data-ttu-id="08ed6-239">Dimensioni (in byte)</span><span class="sxs-lookup"><span data-stu-id="08ed6-239">Size(in bytes)</span></span>|<span data-ttu-id="08ed6-240">Descrizione</span><span class="sxs-lookup"><span data-stu-id="08ed6-240">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="08ed6-241">Type</span><span class="sxs-lookup"><span data-stu-id="08ed6-241">Type</span></span>|<span data-ttu-id="08ed6-242">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-242">2</span></span>|<span data-ttu-id="08ed6-243">Tipo di voce, deve essere FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="08ed6-243">Type of Entry, must be FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span></span>|
|<span data-ttu-id="08ed6-244">Dimensione</span><span class="sxs-lookup"><span data-stu-id="08ed6-244">Size</span></span>|<span data-ttu-id="08ed6-245">2</span><span class="sxs-lookup"><span data-stu-id="08ed6-245">2</span></span>|<span data-ttu-id="08ed6-246">Dimensioni di questa voce</span><span class="sxs-lookup"><span data-stu-id="08ed6-246">Size of this entry</span></span>|
|<span data-ttu-id="08ed6-247">Numero di cluster</span><span class="sxs-lookup"><span data-stu-id="08ed6-247">Cluster Number</span></span>|<span data-ttu-id="08ed6-248">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-248">4</span></span>|<span data-ttu-id="08ed6-249">Numero di cluster</span><span class="sxs-lookup"><span data-stu-id="08ed6-249">Cluster number</span></span>|
|<span data-ttu-id="08ed6-250">Valore</span><span class="sxs-lookup"><span data-stu-id="08ed6-250">Value</span></span>|<span data-ttu-id="08ed6-251">4</span><span class="sxs-lookup"><span data-stu-id="08ed6-251">4</span></span>|<span data-ttu-id="08ed6-252">Valore da scrivere nella voce FAT</span><span class="sxs-lookup"><span data-stu-id="08ed6-252">Value to be written into the FAT entry</span></span>|

## <a name="fault-tolerant-protection"></a><span data-ttu-id="08ed6-253">Protezione con tolleranza di errore</span><span class="sxs-lookup"><span data-stu-id="08ed6-253">Fault Tolerant Protection</span></span>

<span data-ttu-id="08ed6-254">Dopo l'avvio del modulo a tolleranza di errore FileX, viene innanzitutto eseguita la ricerca di un file di log a tolleranza di errore esistente nel supporto.</span><span class="sxs-lookup"><span data-stu-id="08ed6-254">After the FileX Fault Tolerant Module starts, it first searches for an existing fault tolerant log file in the media.</span></span> <span data-ttu-id="08ed6-255">Se non è possibile trovare un file di log valido, FileX considera i supporti non protetti.</span><span class="sxs-lookup"><span data-stu-id="08ed6-255">If a valid log file cannot be found, FileX considers the media unprotected.</span></span> <span data-ttu-id="08ed6-256">In questo caso FileX creerà un file di log a tolleranza di errore nel supporto.</span><span class="sxs-lookup"><span data-stu-id="08ed6-256">In this case FileX will create a fault tolerant log file on the media.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="08ed6-257">\* FileX non è in grado di proteggere un file system se è stato danneggiato prima dell'avvio del modulo a tolleranza di errore FileX.</span><span class="sxs-lookup"><span data-stu-id="08ed6-257">\*FileX is not able to protect a file system if it was corrupted before the FileX Fault Tolerant Module starts.</span></span> *

<span data-ttu-id="08ed6-258">Se si trova un file di log a tolleranza di errore, FileX controlla le voci di log esistenti.</span><span class="sxs-lookup"><span data-stu-id="08ed6-258">If a fault tolerant log file is located, FileX checks for existing log entries.</span></span> <span data-ttu-id="08ed6-259">Un file di log senza voce di log indica che l'operazione di file precedente è stata completata e che tutte le voci di log sono state rimosse.</span><span class="sxs-lookup"><span data-stu-id="08ed6-259">A log file with no log entry indicates prior file operation was successful, and all log entries were removed.</span></span> <span data-ttu-id="08ed6-260">In questo caso l'applicazione può iniziare a usare la file system con protezione a tolleranza di errore.</span><span class="sxs-lookup"><span data-stu-id="08ed6-260">In this case the application can start using the file system with fault tolerant protection.</span></span>

<span data-ttu-id="08ed6-261">Tuttavia, se vengono individuate le voci di log, FileX deve completare l'operazione precedente sui file oppure ripristinare le modifiche già applicate al file system, annullare le modifiche in modo efficace.</span><span class="sxs-lookup"><span data-stu-id="08ed6-261">However if log entries are located, FileX needs to either complete the prior file operation, or revert the changes already applied to the file system, effectively undo the changes.</span></span> <span data-ttu-id="08ed6-262">In entrambi i casi, dopo aver applicato le voci di log al file system, il file system viene ripristinato in uno stato coerente e l'applicazione può iniziare a usare nuovamente il file system.</span><span class="sxs-lookup"><span data-stu-id="08ed6-262">In either case, after the log entries are applied to the file system, the file system is restored into a coherent state, and application can start using the file system again.</span></span>

<span data-ttu-id="08ed6-263">Per il supporto protetto da FileX, durante l'operazione di aggiornamento dei file la parte relativa ai dati viene scritta direttamente nei supporti.</span><span class="sxs-lookup"><span data-stu-id="08ed6-263">For media protected by FileX, during file update operation, the data portion is written directly to the media.</span></span> <span data-ttu-id="08ed6-264">Quando FileX scrive i dati, registra anche tutte le modifiche necessarie per l'applicazione alle voci di directory e alla tabella FAT.</span><span class="sxs-lookup"><span data-stu-id="08ed6-264">As FileX writes data, it also records any changes needed to be applied to directory entries, FAT table.</span></span> <span data-ttu-id="08ed6-265">Queste informazioni vengono registrate nelle voci di log a tolleranza di file.</span><span class="sxs-lookup"><span data-stu-id="08ed6-265">This information is recorded in the file tolerant log entries.</span></span> <span data-ttu-id="08ed6-266">Questo approccio garantisce che gli aggiornamenti al file system si verifichino dopo che i dati sono stati scritti nei supporti.</span><span class="sxs-lookup"><span data-stu-id="08ed6-266">This approach guarantees that updates to the file system occur after the data is written to the media.</span></span> <span data-ttu-id="08ed6-267">Se il supporto viene espulso durante la fase di scrittura dei dati, le informazioni cruciali file system non sono ancora state modificate.</span><span class="sxs-lookup"><span data-stu-id="08ed6-267">If the media is ejected during the data-write phase, crucial file system information has not been changed yet.</span></span> <span data-ttu-id="08ed6-268">Di conseguenza, il file system non è influenzato dall'interruzione.</span><span class="sxs-lookup"><span data-stu-id="08ed6-268">Therefore the file system is not affected by the interruption.</span></span>

<span data-ttu-id="08ed6-269">Dopo che tutti i dati sono stati scritti correttamente nel supporto, FileX segue le informazioni contenute nelle voci di log per applicare le modifiche alle informazioni di sistema, una voce alla volta.</span><span class="sxs-lookup"><span data-stu-id="08ed6-269">After all the data is successfully written to the media, FileX then follows information in the log entries to applies the changes to system information, one entry at a time.</span></span> <span data-ttu-id="08ed6-270">Dopo aver eseguito il commit di tutte le informazioni di sistema sul supporto, le voci di log vengono rimosse dal log a tolleranza di errore.</span><span class="sxs-lookup"><span data-stu-id="08ed6-270">After all the system information is committed to the media, the log entries are removed from the fault tolerant log.</span></span> <span data-ttu-id="08ed6-271">A questo punto, FileX completa l'operazione di aggiornamento del file.</span><span class="sxs-lookup"><span data-stu-id="08ed6-271">At this point, FileX completes the file update operation.</span></span>

<span data-ttu-id="08ed6-272">Durante l'operazione di aggiornamento dei file, i file non vengono aggiornati sul posto.</span><span class="sxs-lookup"><span data-stu-id="08ed6-272">During file update operation, files are not updated in place.</span></span> <span data-ttu-id="08ed6-273">Il modulo a tolleranza di errore alloca un settore per i dati in cui scrivere i nuovi dati, quindi rimuove il settore che contiene i dati da sovrascrivere, aggiornando le voci FAT correlate per collegare il nuovo settore in chian.</span><span class="sxs-lookup"><span data-stu-id="08ed6-273">The fault tolerant module allocates a sector for the data to write the new data into, and then remove the sector that contains the data to be overwritten, updating related FAT entries to link the new sector into the chian.</span></span> <span data-ttu-id="08ed6-274">Per le situazioni in cui è necessario modificare i dati parziali in un cluster, FileX alloca sempre nuovi cluster, scrive tutti i dati dei vecchi cluster con dati aggiornati nei nuovi cluster, quindi libera i cluster precedenti.</span><span class="sxs-lookup"><span data-stu-id="08ed6-274">For situations in which partial data in a cluster needs to be modified, FileX always allocates new clusters, writes the entire data from the old clusters with updated data into the new clusters, then frees up the old clusters.</span></span> <span data-ttu-id="08ed6-275">In questo modo si garantisce che se l'aggiornamento del file viene interrotto, il file originale è intatto.</span><span class="sxs-lookup"><span data-stu-id="08ed6-275">This guarantees that if the file update is interrupted, the original file is intact.</span></span> <span data-ttu-id="08ed6-276">L'applicazione deve tenere presente che, con la protezione a tolleranza di errore di FileX, l'aggiornamento dei dati in un file richiede che i supporti dispongano di spazio libero sufficiente per contenere nuovi dati prima che possano essere rilasciati i settori con dati obsoleti.</span><span class="sxs-lookup"><span data-stu-id="08ed6-276">The application needs to be aware that under FileX fault tolerant protection, updating data in a file requires the media to have enough free space to hold new data before sectors with old data can be released.</span></span> <span data-ttu-id="08ed6-277">Se il supporto non dispone di spazio sufficiente per contenere nuovi dati, l'operazione di aggiornamento ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="08ed6-277">If the media doesn't have enough space to hold new data, the update operation fails.</span></span>
